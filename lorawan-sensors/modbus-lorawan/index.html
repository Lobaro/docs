


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Online documentation of the Lobaro GmbH, Industrial IoT Solutions. Manuals for our IoT Devices.">
      
      
      
      <link rel="shortcut icon" href="../../favicon.ico">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.0">
    
    
      
        <title>Manual - Lobaro Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.89dc9fe3.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ecd4686e.min.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CCousine&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cousine",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/lobarodoc.css">
    
      <link rel="stylesheet" href="../../css/simple-lightbox.min.css">
    
    
      
        
<link rel="preconnect dns-prefetch" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-69919312-3","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#modbus-ascii-rtu-over-lorawan-bridge" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Lobaro Documentation" class="md-header-nav__button md-logo" aria-label="Lobaro Documentation">
      
  <img src="../../img/lobaro-rings-circle.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Lobaro Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Manual
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/lobaro/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Lobaro Documentation" class="md-nav__button md-logo" aria-label="Lobaro Documentation">
      
  <img src="../../img/lobaro-rings-circle.svg" alt="logo">

    </a>
    Lobaro Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/lobaro/docs/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../index.html" title="Documentation Start" class="md-nav__link">
      Documentation Start
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      LoRaWAN Sensors
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="LoRaWAN Sensors" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        LoRaWAN Sensors
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1">
    
    <label class="md-nav__link" for="nav-2-1">
      wMBUS Bridge
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="wMBUS Bridge" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        wMBUS Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../wmbus-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../wmbus-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2" checked>
    
    <label class="md-nav__link" for="nav-2-2">
      Modbus Bridge
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Modbus Bridge" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Modbus Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Manual
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="index.html" title="Manual" class="md-nav__link md-nav__link--active">
      Manual
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    Key Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#target-measurement-purpose" class="md-nav__link">
    Target Measurement / Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-devices" class="md-nav__link">
    Supported Devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#product-variants" class="md-nav__link">
    Product variants
  </a>
  
    <nav class="md-nav" aria-label="Product variants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variant-battery-powered" class="md-nav__link">
    Variant battery powered
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variant-external-powered" class="md-nav__link">
    Variant external powered
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modbus-introduction" class="md-nav__link">
    Modbus Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start Guide
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-cycle" class="md-nav__link">
    Work Cycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lorawan" class="md-nav__link">
    LoRaWAN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modbusuart" class="md-nav__link">
    Modbus/UART
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modbus-commands" class="md-nav__link">
    Modbus Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-before-talk" class="md-nav__link">
    Listen-Before-Talk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#payload-formats" class="md-nav__link">
    Payload formats
  </a>
  
    <nav class="md-nav" aria-label="Payload formats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uplink" class="md-nav__link">
    Uplink
  </a>
  
    <nav class="md-nav" aria-label="Uplink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#status-messages" class="md-nav__link">
    Status messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-messages" class="md-nav__link">
    Data messages
  </a>
  
    <nav class="md-nav" aria-label="Data messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verbose-payload-format" class="md-nav__link">
    Verbose payload format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-payload-format" class="md-nav__link">
    Compact payload format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-messages" class="md-nav__link">
    Split messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downlink" class="md-nav__link">
    Downlink
  </a>
  
    <nav class="md-nav" aria-label="Downlink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modbus-commands_1" class="md-nav__link">
    Modbus Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-configuration" class="md-nav__link">
    Remote Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uplinks-triggered-by-configuration" class="md-nav__link">
    Uplinks triggered by configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uplinks-triggered-by-downlink-commands" class="md-nav__link">
    Uplinks triggered by Downlink Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dialog-mode" class="md-nav__link">
    Dialog Mode
  </a>
  
    <nav class="md-nav" aria-label="Dialog Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dialog-mode-example" class="md-nav__link">
    Dialog Mode Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-setups" class="md-nav__link">
    Complex setups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendices" class="md-nav__link">
    Appendices
  </a>
  
    <nav class="md-nav" aria-label="Appendices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#technical-characteristics" class="md-nav__link">
    Technical characteristics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ce-declaration-of-conformity" class="md-nav__link">
    CE Declaration of Conformity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disposal-weee-entsorgung" class="md-nav__link">
    Disposal / WEEE / Entsorgung
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-decoder" class="md-nav__link">
    Reference decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="versions.html" title="Versions" class="md-nav__link">
      Versions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      EDL21 Bridge
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="EDL21 Bridge" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        EDL21 Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../edl21-opto-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../edl21-opto-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      1-Wire Bridge
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="1-Wire Bridge" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        1-Wire Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1-wire-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../1-wire-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      GPS Tracker
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="GPS Tracker" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        GPS Tracker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../gps-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../gps-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Usonic Distance Sensor
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Usonic Distance Sensor" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Usonic Distance Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../usonic-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../usonic-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-7" type="checkbox" id="nav-2-7">
    
    <label class="md-nav__link" for="nav-2-7">
      Temp. + rH. Sensor
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Temp. + rH. Sensor" data-md-level="2">
      <label class="md-nav__title" for="nav-2-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Temp. + rH. Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../humidity-temp-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../humidity-temp-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-8" type="checkbox" id="nav-2-8">
    
    <label class="md-nav__link" for="nav-2-8">
      Pressure Sensor
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Pressure Sensor" data-md-level="2">
      <label class="md-nav__title" for="nav-2-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Pressure Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../pressure-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../pressure-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-9" type="checkbox" id="nav-2-9">
    
    <label class="md-nav__link" for="nav-2-9">
      Environment Sensor
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Environment Sensor" data-md-level="2">
      <label class="md-nav__title" for="nav-2-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Environment Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../environment-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../environment-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-10" type="checkbox" id="nav-2-10">
    
    <label class="md-nav__link" for="nav-2-10">
      LoRaWAN Modbus Gateway
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="LoRaWAN Modbus Gateway" data-md-level="2">
      <label class="md-nav__title" for="nav-2-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        LoRaWAN Modbus Gateway
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../lorawan-modbus-gateway/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      NB-IoT / LTE-M Sensors
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="NB-IoT / LTE-M Sensors" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        NB-IoT / LTE-M Sensors
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../nbiot-sensors/wmbus-nbiot/index.html" title="wMBus Gateway" class="md-nav__link">
      wMBus Gateway
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Background Articles
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Background Articles" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Background Articles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hardware.html" title="Hardware Variations" class="md-nav__link">
      Hardware Variations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../background/cron-expressions.html" title="CRON Expressions" class="md-nav__link">
      CRON Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../background/lorawan.html" title="LoRaWAN" class="md-nav__link">
      LoRaWAN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../background/obis-codes.html" title="OBIS Codes" class="md-nav__link">
      OBIS Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../background/weee-disposal.html" title="WEEE Disposal" class="md-nav__link">
      WEEE Disposal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Lobaro Tools
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Lobaro Tools" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Lobaro Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/lobaro-tool.html" title="Lobaro Maintenance Tool" class="md-nav__link">
      Lobaro Maintenance Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tools/usb-config-adapter.html" title="USB Config Adapter" class="md-nav__link">
      USB Config Adapter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Lobaro IoT Platform
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Lobaro IoT Platform" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Lobaro IoT Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/integrations.html" title="Integrations" class="md-nav__link">
      Integrations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/parser.html" title="Parser" class="md-nav__link">
      Parser
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/table-config.html" title="Table Config" class="md-nav__link">
      Table Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6-5" type="checkbox" id="nav-6-5">
    
    <label class="md-nav__link" for="nav-6-5">
      Changelog
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Changelog" data-md-level="2">
      <label class="md-nav__title" for="nav-6-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Changelog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/changelog-frontend.html" title="Frontend" class="md-nav__link">
      Frontend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../platform/changelog-backend.html" title="Backend" class="md-nav__link">
      Backend
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://www.lobaro-shop.com/" title="Lobaro Shop" class="md-nav__link">
      Lobaro Shop
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://www.lobaro.com/contact/" title="Contact / Impressum" class="md-nav__link">
      Contact / Impressum
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    Key Features
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#target-measurement-purpose" class="md-nav__link">
    Target Measurement / Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#supported-devices" class="md-nav__link">
    Supported Devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#product-variants" class="md-nav__link">
    Product variants
  </a>
  
    <nav class="md-nav" aria-label="Product variants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#variant-battery-powered" class="md-nav__link">
    Variant battery powered
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variant-external-powered" class="md-nav__link">
    Variant external powered
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modbus-introduction" class="md-nav__link">
    Modbus Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start-guide" class="md-nav__link">
    Quick Start Guide
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-cycle" class="md-nav__link">
    Work Cycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lorawan" class="md-nav__link">
    LoRaWAN
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modbusuart" class="md-nav__link">
    Modbus/UART
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modbus-commands" class="md-nav__link">
    Modbus Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#listen-before-talk" class="md-nav__link">
    Listen-Before-Talk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#payload-formats" class="md-nav__link">
    Payload formats
  </a>
  
    <nav class="md-nav" aria-label="Payload formats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uplink" class="md-nav__link">
    Uplink
  </a>
  
    <nav class="md-nav" aria-label="Uplink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#status-messages" class="md-nav__link">
    Status messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-messages" class="md-nav__link">
    Data messages
  </a>
  
    <nav class="md-nav" aria-label="Data messages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verbose-payload-format" class="md-nav__link">
    Verbose payload format
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compact-payload-format" class="md-nav__link">
    Compact payload format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-messages" class="md-nav__link">
    Split messages
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#downlink" class="md-nav__link">
    Downlink
  </a>
  
    <nav class="md-nav" aria-label="Downlink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#modbus-commands_1" class="md-nav__link">
    Modbus Commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote-configuration" class="md-nav__link">
    Remote Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uplinks-triggered-by-configuration" class="md-nav__link">
    Uplinks triggered by configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uplinks-triggered-by-downlink-commands" class="md-nav__link">
    Uplinks triggered by Downlink Commands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dialog-mode" class="md-nav__link">
    Dialog Mode
  </a>
  
    <nav class="md-nav" aria-label="Dialog Mode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dialog-mode-example" class="md-nav__link">
    Dialog Mode Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-setups" class="md-nav__link">
    Complex setups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendices" class="md-nav__link">
    Appendices
  </a>
  
    <nav class="md-nav" aria-label="Appendices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#technical-characteristics" class="md-nav__link">
    Technical characteristics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ce-declaration-of-conformity" class="md-nav__link">
    CE Declaration of Conformity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disposal-weee-entsorgung" class="md-nav__link">
    Disposal / WEEE / Entsorgung
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-decoder" class="md-nav__link">
    Reference decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/lobaro/docs/edit/master/docs/lorawan-sensors/modbus-lorawan/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="modbus-ascii-rtu-over-lorawan-bridge">Modbus (ASCII / RTU) over LoRaWAN Bridge</h1>
<p>Version <strong>v1.x.x</strong> <em>(since 2019-10-16)</em> <br>
This is the latest version. For older revisions please refer to the <a href="versions.html">version overview</a>.</p>
<div class="admonition warning">
<p class="admonition-title">This version has a different upload format than older versions!</p>
<p>If you are using 0.3.x firmware, please see the <a href="0.3.0">0.3.x Manual</a>. <br>
If you are updating to this firmware, be aware that you will have to update your 
configuration and the parser in your backend.</p>
</div>
<!--Version v1.0.0 *(since 2019-09-16)* <br>
This the manual for an unreleased version of the firmware. For older revisions please refer to the [version overview](../versions.md).
-->

<!-- *This manual is for an older version of the Modbus Bridge!* <br>
[latest version](../) &ndash; [version overview](../versions) -->

<h2 id="key-features">Key Features</h2>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> LoRaWAN 1.0.x and 1.1 network servers supported</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> LoRaWAN Class A or Class C operation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> LoRaWAN 1.1 time synchronisation</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Configuration via USB or remotely via LoRaWAN downlink</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> ModBus ASCII and RTU modes supported</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Readout of ModBus Coils, Discrete Inputs, Input Registers and Holding Registers</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> ModBus dialog mode via USB for easy configuration testing</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Coexistence with 2<sup>nd</sup> Modbus Master possible (bus sharing, Listen before talk)</li>
</ul>
<h2 id="target-measurement-purpose">Target Measurement / Purpose</h2>
<p>The Lobaro Modbus LoRaWAN Bridge is a low power device that can be used to communicate with 
Modbus Slave devices (ASCII/RTU) on a RS-485 bus over a LoRaWAN network.
Modbus commands can be transmitted via Downlink message to the Bridge and are forwarded by 
the Bridge to the connected Slave Devices. Received responses are forwarded via LoRaWAN 
Uplink messages. The Modbus Bridge can also be configured to execute Modbus commands 
regularly and report the responses via LoRaWAN uplinks.</p>
<p>The Bridge supports LoRaWAN Operation Mode <em>Class A</em> for power efficient operation
(for long operation periods powered by battery), as well as <em>Class C</em> to enable short 
reaction time to Downlink requests.</p>
<p><img alt="Modbus LoRaWAN Bridge" src="files/modbus-lorawan.png" style="width:50%; vertical-align: top;" /></p>
<p>The Modbus Bridge supports reading of all four object types that can be provided by 
Modbus slave devices: Coil, Discrete Input, Input Register, and Holding Register. 
It also supports writing values to both writable objects: Coils and Holding Registers.
Multiple different slave devices on the Bus can be accessed individually by a single 
Bridge device. Reading intervals and register definitions can be configured very 
flexibly to suit individual requirements.</p>
<p>Typical applications for Modbus devices include reading out electric and water meters or 
retrieving data from environmental sensors like temperature and humidity.
Industrial machines as well as solar panel installations often include a Modbus 
connection to supply supervision and automated operation.</p>
<h2 id="supported-devices">Supported Devices</h2>
<p>The Lobaro Modbus LoRaWAN Bridge works with all devices that act as a Modbus Client 
using RTU or ASCII (Modbus TCP is <em>not</em> supported). Some devices that have been used successfully 
with the Bridge:</p>
<table>
<thead>
<tr>
<th>Device</th>
<th>Type</th>
<th>Manufacturer</th>
<th>More information</th>
</tr>
</thead>
<tbody>
<tr>
<td>Octave Ultrasonic Meter</td>
<td>Water meter</td>
<td>Arad Group</td>
<td><a href="https://arad.co.il/product/octave/">External Link</a></td>
</tr>
<tr>
<td>ECL Controller</td>
<td>Heat/Hot Water Regulation</td>
<td>Danfoss</td>
<td><a href="https://www.danfoss.com/en/products/electronic-controls/dhs/electronic-controllers-and-application-keys/ecl-controllers/">External Link</a></td>
</tr>
<tr>
<td>UMD 97</td>
<td>Smart Grid Power Meter</td>
<td>PQ Plus</td>
<td><a href="https://www.pq-plus.de/news/pqplus/umd-97-messgeraet.html">External Link (German)</a></td>
</tr>
<tr>
<td>DRS458DE</td>
<td>Power Meter</td>
<td>B+G E-Tech GmbH</td>
<td><a href="https://bg-etech.de/Bedienungsanleitungen.html">External Link</a></td>
</tr>
</tbody>
</table>
<h2 id="product-variants">Product variants</h2>
<p>The LoRaWAN Modbus bridge can be ordered in two standard variants. For even more customizations options see
<a href="/hardware.html">Hardware Variants</a> overview.</p>
<h3 id="variant-battery-powered">Variant battery powered</h3>
<p><code>LoRaWAN Modbus Bridge (XH battery connector, IP67 housing), Order number: 8000041</code> <br>
<code>ER34615 (3.6V Battery, XH Connector, 0.2A), Order number: 3000169</code>
<img alt="Modbus " src="files/ModbusLoRaWAN-Bridge-D-Zelle-Batterie.jpg" style="width:55%;" /></p>
<h3 id="variant-external-powered">Variant external powered</h3>
<p><code>LoRaWAN Modbus Bridge (ext. Power, Din-Rail, no housing), Order number: 8000043</code><br>
<code>DR-15-5 DIN-Rail power supply 5V, Order number: 3000006</code><br>
<code>RK 4/12-L DIN-Rail Housing, Order number: 3000005</code></p>
<p><img alt="Modbus " src="files/ModbusLoRaWAN-Bridge.jpg" style="width:55%;" /></p>
<p><a href="files/Modbus-LoRaWAN-Specs.pdf">Data Sheet with dimensions (PDF)</a></p>
<hr />
<div class="admonition note">
<p class="admonition-title">Further customization Options</p>
<p>The product variants shown above are the <em>standard</em> variants.</p>
<p><a href="../../hardware.html" target="_blank"><strong>Other power supply options &amp; housing are available on request</strong></a></p>
<ul>
<li>External antenna</li>
<li>AA batteries</li>
<li>NB-IoT instead of LoRaWAN</li>
</ul>
<p>Contact us via <a href="mailto:support@lobaro.de">support@lobaro.de</a> if you need our offer for a special variant.</p>
</div>
<h2 id="modbus-introduction">Modbus Introduction</h2>
<p>Modbus defines four different object types form which values can be read:
Coils, Discrete Inputs, Input Registers, and Holding Registers.
Of those four, Coils and Holding Registers can also be written to. 
Coils and Discrete Inputs hold single bit values while Input Registers and 
Holding Registers hold 16 bit values. For values that cannot fit into 16 bit, it is 
customary to use multiple consecutive registers to hold the value. Modbus does not 
define what the bytes in the registers represent; it is up to the creator of the 
Modbus Slave Device to specify how to interpret the stored bits. A 16 bit register could 
be used to hold a single byte value, for example, or four consecutive registers could 
hold a double precision floating point number. Storing texts as ASCII characters is also 
possible. For integer numbers in particular it there is no defined byte order, nor signage 
definition. Because of those ambiguities it is not possible for the Lobaro LoRaWAN Bridge to 
understand the data read from/written to Slave Devices. All communications therefore simply 
forward raw Modbus Commands and Responses with their payload, as it communicated on the Bus.
Any check sums (CRC16 for RTU, LRC for ASCII) are excluded from LoRaWAN communications or the 
Bridge's configuration, as there are other check sums in work their already.</p>
<p>For a deeper introduction into Modbus please refer to 
<a href="https://en.wikipedia.org/wiki/Modbus">https://en.wikipedia.org/wiki/Modbus</a>.</p>
<h2 id="quick-start-guide">Quick Start Guide</h2>
<div class="admonition info">
<p class="admonition-title">Please refer to the rest of this documentation for a save and proper use of the Modbus Bridge.</p>
<p>This Quick Start Guide can only show you basic operations. It illustrates reading 
a single value from one Slave Device.</p>
</div>
<ul>
<li>Connect the Modbus Bridge to your Modbus Slave Device using the RS485 connection using 
  a twisted pair cable: 
  <code>A</code> to <code>A</code>, <code>B</code> to <code>B</code>, and <code>GND</code> to <code>GND</code> (<code>GND</code> is not strictly necessary but enhances the
  connection. Not all slave devices supply a <code>GND</code> connector).</li>
<li>Connect the Modbus Bridge to a computer using the 
  <a href="/tools/usb-config-adapter.html">Lobaro Configuration Adapter</a> and the 
  <a href="/tools/lobaro-tool.html">Lobaro Maintenance Tool</a>.</li>
<li>Synchronise the LoRaWAN configuration parameters between the Bridge and your 
  Network Server.</li>
<li>Make sure the Bridge is in reach of a Gateway attached to your Network Server.</li>
<li>Set the Modbus Parameters according to your Slave Device 
  (ASCII/RTU, Baud, Data Length, Stop Bits, Parity).</li>
<li>Set <code>MbCmd</code> to the Modbus Command to read the register you need (see below).</li>
<li>Save the configuration and switch to the Log tab. You should see the device
  requesting the data and uploading it via LoRaWAN.</li>
</ul>
<p><code>MbCmd</code> must contain the Modbus Command the Bridge will execute. The command is 
entered in Hex and without any checksums and is 6 bytes long (12 hexdigits). 
The default value is <code>010300000003</code>, it consists of 4 parts: <code>01</code>, <code>03</code>, <code>0000</code>, <code>0003</code></p>
<dl>
<dt><code>01</code></dt>
<dd>Address of the Slave Device. 1 byte: often <code>01</code> new devices</dd>
<dt><code>03</code></dt>
<dd>What kind of Modbus Register to read. 1 byte. <code>03</code> stand for <em>Holding Register</em>.</dd>
<dt><code>0000</code></dt>
<dd>Number/address of the first register to read. 2 bytes. 
Many devices have some value to read out at <code>0000</code>.</dd>
<dt><code>0003</code></dt>
<dd>Number of consecutive registers to read from the first register. 2 bytes. This
would read the registers #0, #1, and #2 in one command.</dd>
</dl>
<p>The format used for <code>MbCmd</code> is conforming to the Modbus Standard. 
See <a href="#modbus-commands">Configurations/Modbus Commands</a> for a description and 
<a href="#examples">Examples</a> for some more advance examples. The Modbus Bridge has a 
<a href="#dialog-mode">Dialog Mode</a> that lets you try out Modbus Commands interactively 
which helps getting used to the syntax and helps you in trying out your slave devices.</p>
<h2 id="work-cycle">Work Cycle</h2>
<p>The Modbus LoRaWAN Bridge has a simple work cycle. It spends most of the time in a deep sleep 
state, to conserve energy. For every reading it wakes up for a few seconds, requests values 
from the connected slave devices, uploads the data via LoRaWAN, and then goes to sleep again.
The following flowchart illustrates the work cycle:</p>
<div class="mermaid">graph LR;
    init(Init)==&gt;check(Test Reading);
    check==&gt;join(LoRaWAN Join);
    join==&gt;read(Data Collection);
    read==&gt;send(Data Transfer);
    send==&gt;sleep("Sleep");
    sleep==&gt;|Cron expression| read;</div>

<dl>
<dt>Init</dt>
<dd>When the device starts (because it has just been connected to a power source, or after 
a reboot) it begins in the <em>Init</em> state. A quick self-check is executed; if that succeeds, 
the green on-board LED blinks once, slowly. After that the configuration is evaluated and 
checked for invalid values. If any problems are detected during <em>Init</em>, the device's LED 
will light up for three times, and the device will then reboot. If everything is okay, the 
device will continue with the <em>Test Reading</em>.</dd>
<dt>Test Reading</dt>
<dd>After verifying configuration, the Bridge executes all Modbus Commands stored once
without uploading the results but logging them only to the console. 
This makes it easy to verify all Modbus Slaves are reachable and their registers can be 
read. Connect your computer to the Bridge using the Lobaro Config Adapter and check 
the output using the Lobaro Maintenance Tool. 
The device will continue with <em>LoRaWAN Join</em> to connect to the Network (whether the 
test reading was successful or not does not change this).</dd>
<dt>LoRaWAN Join</dt>
<dd>The Bridge tries to connect to the LoRaWAN Network. The Details depend on the 
device's configuration (OTAA vs. ABP, optional Time synchronisation). Unless ABP
is used, the Bridge will remain in this state until joining succeeds. It will 
repeat to send Join requests with decreasing frequency. 
After successfully attaching it enters <em>Data Collection</em> for the first time and
starts the normal operation cycle.</dd>
<dt>Data Collection</dt>
<dd>The Bridge sends all Modbus Commands from the Configuration on the Bus and 
collects the answers (or lack thereof).</dd>
<dt>Data Transfer</dt>
<dd>The collected Modbus Responses are uploaded via LoRaWAN. This can take multiple 
upload messages depending on the amount of data collected.  Once a day a status
message is also uploaded, giving some information about the state of the Bridge 
itself. If many messages are uploaded this can take a long time. At least one 
message is uploaded during this state. When all data is uploaded, the device 
goes to <em>Sleep</em>.</dd>
<dt>Sleep</dt>
<dd>Between activations the device enters a very power efficient sleep mode. It 
stays dormant until the time specified by the Cron expression, when it changes 
back to <em>Data Collection</em>. </dd>
</dl>
<h2 id="configuration">Configuration</h2>
<p>The (initial) configuration is normally done using our free <a href="/tools/lobaro-tool.html">Lobaro Maintenance Tool</a> 
and the <a href="/tools/usb-config-adapter.html">USB PC configuation adapter</a>.</p>
<p>Beside this the configuration can also be changed or read remotely in the field 
using LoRaWAN <strong>downlink messages</strong>, see <a href="#downlink">Downlinks</a> description.</p>
<h3 id="lorawan">LoRaWAN</h3>
<p>The connection to the LoRaWAN network is defined by multiple configuration parameters.
This need to be set according to your LoRaWAN network and the way your device is 
supposed to be attached to it, or the device will not be able to send any data.</p>
<p>For a detailed introduction into how this values need to be configured, please 
refer to the chapter <a href="/background/lorawan.html#lorawan-configuration">LoRaWAN configuration</a> 
in our LoRaWAN background article.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Type</th>
<th>Values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OTAA</code></td>
<td>Activation: OTAA or ABP</td>
<td><code>bool</code></td>
<td><code>true</code>= use OTAA, <code>false</code>= use ABP</td>
</tr>
<tr>
<td><code>DevEUI</code></td>
<td>DevEUI used to identify the Device</td>
<td><code>byte[8]</code></td>
<td>e.g. <code>0123456789abcdef</code></td>
</tr>
<tr>
<td><code>JoinEUI</code></td>
<td>Used for OTAA (called AppEUI in v1.0)</td>
<td><code>byte[8]</code></td>
<td>e.g. <code>0123456789abcdef</code></td>
</tr>
<tr>
<td><code>AppKey</code></td>
<td>Key used for OTAA (v1.0 and v1.1)</td>
<td><code>byte[16]</code></td>
<td></td>
</tr>
<tr>
<td><code>NwkKey</code></td>
<td>Key used for OTAA (v1.1 only)</td>
<td><code>byte[16]</code></td>
<td></td>
</tr>
<tr>
<td><code>SF</code></td>
<td>Initial / maximum Spreading Factor</td>
<td><code>int</code></td>
<td><code>7</code> - <code>12</code></td>
</tr>
<tr>
<td><code>ADR</code></td>
<td>Use Adaptive Data Rate</td>
<td><code>bool</code></td>
<td><code>true</code>= use ADR, <code>false</code>= don't</td>
</tr>
<tr>
<td><code>OpMode</code></td>
<td>Operation Mode</td>
<td><code>string</code></td>
<td><code>A</code>= Class A, <code>C</code>= Class C</td>
</tr>
<tr>
<td><code>TimeSync</code></td>
<td>Days after which to sync time</td>
<td><code>int</code></td>
<td>days, <code>0</code>=don't sync time</td>
</tr>
<tr>
<td><code>RndDelay</code></td>
<td>Random delay before sending</td>
<td><code>int</code></td>
<td>max seconds</td>
</tr>
<tr>
<td><code>RemoteConf</code></td>
<td>Support Remote Configuration</td>
<td><code>bool</code></td>
<td><code>true</code>=allow, <code>false</code>=deactivate</td>
</tr>
<tr>
<td><code>LostReboot</code></td>
<td>Days without downlink before reboot</td>
<td><code>int</code></td>
<td>days, <code>0</code>=don't reboot</td>
</tr>
</tbody>
</table>
<h3 id="modbusuart">Modbus/UART</h3>
<p>There are several values that define the configuration via Modbus. These 
values depend on the Slave devices that you want to read out. Please refer to your 
Modbus Devices's manual to find out the correct configuration.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th>values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MbProt</code></td>
<td>Modbus-Protocol to use</td>
<td><code>RTU</code>. <code>ASCII</code></td>
</tr>
<tr>
<td><code>MbBaud</code></td>
<td>UART Baud rate</td>
<td><code>9600</code>, <code>19200</code>, <code>38400</code>, ...</td>
</tr>
<tr>
<td><code>MbDataLen</code></td>
<td>UART data length</td>
<td><code>7</code>, <code>8</code>, <code>9</code></td>
</tr>
<tr>
<td><code>MbStopBits</code></td>
<td>UART stop bits</td>
<td><code>0.5</code>, <code>1</code>, <code>1.5</code>, <code>2</code> (written exactly like this)</td>
</tr>
<tr>
<td><code>MbPar</code></td>
<td>UART parity</td>
<td><code>NONE</code>, <code>EVEN</code>, <code>ODD</code></td>
</tr>
<tr>
<td><code>MbCron</code></td>
<td>Cron expression<sup>&dagger;</sup> defining when to read.</td>
<td><code>0 0/15 * * * *</code> for every 15 minutes</td>
</tr>
<tr>
<td><code>MbCmd</code></td>
<td>List of Modbus Commands (see below).</td>
<td><code>010300010003</code></td>
</tr>
<tr>
<td><code>PlFmt</code></td>
<td>Uplink Format</td>
<td><code>1</code>, <code>2</code>, or <code>3</code>, see <a href="#payload-formats">Payload Formats</a></td>
</tr>
<tr>
<td><code>EnDL</code></td>
<td>Enable Downlinks</td>
<td><code>true</code>= enable sending <a href="#downlink">Modbus Commands via Downlink</a></td>
</tr>
<tr>
<td><code>DialogMode</code></td>
<td>Enable Dialog Mode</td>
<td><code>true</code>= set the Bridge to <a href="#dialog-mode">Dialog Mode</a></td>
</tr>
<tr>
<td><code>LbtDuration</code></td>
<td>Listen-before-talk Duration</td>
<td><code>0</code>= disables, <code>1</code>-<code>3600</code>= seconds of lbt duration</td>
</tr>
<tr>
<td><code>LbtSilence</code></td>
<td>Listen-before-talk Silence</td>
<td><code>0</code>= disabled, <code>1</code>-<code>3600</code> seconds of silence needed</td>
</tr>
</tbody>
</table>
<p><sup>&dagger;</sup> See also our <a href="/background/cron-expressions.html">Introduction to Cron expressions</a>.</p>
<h3 id="modbus-commands">Modbus Commands</h3>
<p>Whenever the cron expression given in the configuration value <code>MbCron</code> activates, the 
Modbus Bridge wakes up from hibernation (or listening mode, for Class C), a set of 
configured Modbus Commands (set in the configuration parameter <code>MbCmd</code>) 
is executed over the RS-485 bus. Any responses received from 
the addressed Slave Device will be uploaded via LoRaWAN. </p>
<p>The Modbus Commands to be executed must be entered in the config as hexencoded bytes, 
exactly the way they are to be sent over the bus. Checksums must not be included in the 
configuration. Multiple commands can be added to the configuration, separated by commas (no 
spaces). For example if you want the Bridge to read the Holding Registers 100, 101, and 102 
on two separated Slave Devices with the addresses 9 and 10, you would need to set <code>MbCmd</code> 
to <code>090300640003,0a0300640003</code>.</p>
<p>You can configure any byte sequence you want to be sent; not all will be valid Modbus Commands. 
This feature has been developed to execute register/coil reads and upload the values retrieved. 
It is possible to use it for writing values as well, but the usefulness of that is limited. If 
you configure register writes, be aware that the commands are also executed when the 
device boots!</p>
<p>Keep in mind that the responses to your commands will be sent using LoRaWAN, which has only 
a very limited packet size! Modbus responses can be over 200 bytes long. For reading 
commands, the Modbus Response contains 6 bytes to repeat the command. The data format used 
by the Modbus Bridge adds another 6 bytes. On higher spreading factors with 51 byte 
message limit this only leaves 39 bytes for the actual read data (in EU LoRaWAN configuration,
other areas might have a slightly different number). 
Responses that will not fit into a single LoRaWAN Uplink will be split and uploaded 
using multiple LoRaWAN messages. Your backend will need to those parts back together.
Any message that is the continuation of an earlier uplink will be sent using port 5
(see <a href="#split-messages">Split Messages</a>).</p>
<p>For a short introduction into Modbus Commands and some examples of configurations and their 
created responses, please take a look at the <a href="#examples">examples</a>.</p>
<h3 id="listen-before-talk">Listen-Before-Talk</h3>
<p>If you want to use the Lobaro Modbus Bridge to read out values on an installation that 
already has an active Modbus Master, you will run into conflicts, because the Bridge acts 
as a Master. Normally only a single Master device is allowed on a Modbus installation.
The Bridge supports a <em>Listen-Before-Talk</em> feature, that makes it possible to be used 
alongside a second Master Device (under certain conditions).</p>
<p>If your other Master Device has periods of non-communication that are long enough, you can 
configure the Bridge to wait for those pauses before starting it's own requests: 
When <em>Listen-Before-Talk</em> is activated, the Bridge does not immediately start sending on 
the Bus when it normally would. Instead it starts listening on the Bus until the other Master 
starts talking and then waits for silence to detect when the other Master just finished 
communicating. Only then does it send it's requests.</p>
<p>The Bridge waits for a maximum of <code>LbtDuration</code> seconds for the other Master to start 
communicating. Then it waits for a period of silence that lasts at least <code>LbtSilence</code> 
seconds to decide that the other master has completed its work and is now in pause.</p>
<p>So if, for example, your other Master has a work interval of 2 minutes and is active 
for about 30 seconds without longer pauses, you could set <code>LbtDuration</code> to <code>130</code> 
(10 seconds added as a buffer), and <code>LbtSilence</code> to <code>15</code> (make sure the value is longer 
than the timeout your other master has). </p>
<p>You will have to know exactly how your other Master acts to setup this feature.</p>
<p>If you set either of <code>LbtDuration</code> or <code>LbtSilence</code> to <code>0</code>, you will deactivate
<em>Listen-Before-Talk</em> completely (it is deactivated by default).</p>
<h2 id="payload-formats">Payload formats</h2>
<p>The Modbus Bridge sends two different kinds of messages over three different LoRaWAN ports:</p>
<table>
<thead>
<tr>
<th>Direction</th>
<th align="right">Port</th>
<th align="left">Message</th>
</tr>
</thead>
<tbody>
<tr>
<td>Uplink</td>
<td align="right">1</td>
<td align="left">Status messages.</td>
</tr>
<tr>
<td>Uplink</td>
<td align="right">3</td>
<td align="left">Modbus Responses triggered by configuration.</td>
</tr>
<tr>
<td>Uplink</td>
<td align="right">4</td>
<td align="left">Modbus Responses triggered by Downlinks.</td>
</tr>
<tr>
<td>Uplink</td>
<td align="right">5</td>
<td align="left">Continuation of Responses that do not fit in a single Uplink.</td>
</tr>
<tr>
<td>Downlink</td>
<td align="right">4</td>
<td align="left">Modbus Commands to be forwarded by the Bridge.</td>
</tr>
</tbody>
</table>
<p>In addition to the description we also supply a <a href="#reference-decoder">reference decoder</a> 
usable in TTN at the end of this document.</p>
<h3 id="uplink">Uplink</h3>
<h4 id="status-messages">Status messages</h4>
<p>The Modbus Bridge sends a status messages report on the health of the device itself.
This messages are sent along when the device is sending data packages with a 
maximum of one status message per day. </p>
<p>Status messages are transmitted on port 1 and have a fixed length of 14 bytes.</p>
<table>
<thead>
<tr>
<th>name</th>
<th align="right">pos</th>
<th align="right">len</th>
<th>type</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>version</td>
<td align="right">0</td>
<td align="right">3</td>
<td><code>uint8[3]</code></td>
<td>Version of firmware running on the device</td>
<td><code>[0, 4, 1]</code> &equiv; <code>v0.4.1</code></td>
</tr>
<tr>
<td>flag</td>
<td align="right">3</td>
<td align="right">1</td>
<td><code>uint8</code></td>
<td>Status flag, for internal use</td>
<td><code>0</code></td>
</tr>
<tr>
<td>temperature</td>
<td align="right">4</td>
<td align="right">2</td>
<td><code>int16</code></td>
<td>Device's internal temperature in tenth C</td>
<td><code>246</code> &equiv; <code>24.6C</code></td>
</tr>
<tr>
<td>voltage</td>
<td align="right">6</td>
<td align="right">2</td>
<td><code>uint16</code></td>
<td>Voltage supplied by power source in mV</td>
<td><code>3547</code> &equiv; <code>3.547V</code></td>
</tr>
<tr>
<td>timestamp</td>
<td align="right">8</td>
<td align="right">5</td>
<td><code>int40</code></td>
<td>Internal date/time at creation of the status packet as UNIX timestamp</td>
<td><code>1533055905</code></td>
</tr>
<tr>
<td>opMode</td>
<td align="right">13</td>
<td align="right">1</td>
<td><code>char</code></td>
<td>LoRaWAN Operation mode the device runs</td>
<td><code>A</code> or <code>C</code></td>
</tr>
</tbody>
</table>
<h4 id="data-messages">Data messages</h4>
<p>Data messages contain responses to Modbus Commands received by the Bridge.
The Bridge supports multiple Payload formats for different use cases. The format is selected 
by the configuration parameter <code>PlFmt</code>:</p>
<ul>
<li><code>1</code>: Verbose payload format (port 3)</li>
<li><code>2</code>: Compact payload format with time (port 6)</li>
<li><code>3</code>: Compact payload format without time (port 7)</li>
</ul>
<h5 id="verbose-payload-format">Verbose payload format</h5>
<p>The verbose payload format (<code>PlFmt</code>=<code>1</code>) is the standard setting of the Bridge. It is designed to be very 
versatile (it uploads the complete Response sent by the Slave Devices, so reading registers as well as 
writing registers are both supported). It contains all information you need to know the register and the 
slave device your data is coming from. You do not need to know the exact configuration of your devices in your 
backend to be able to parse the data. This is convenient when you have man Modbus Bridges with different 
configuration in the field. This payload format is also good in communicating error conditions in case 
the executed Modbus Commands fail.
The trade off is overhead in the transmission. If you need to get a lot of data uploaded often, this could 
be a problem for you with the limited LoRaWAN bandwidth. If this is a problem for your use case, you should 
take a look at the compact data formats.</p>
<p>Data messages using the verbose payload format are uploaded on port 3. Every message starts with a 5 byte 
timestamp (UNIX timestamp as big endian <code>int40</code>, 
see <a href="/background/lorawan.html#timestamps">timestamps in our LoRaWAN devices</a>) 
for more information). The timestamp is followed by one or more responses of varying length.</p>
<p>Each of the responses starts with a single byte (<code>uint8</code>) indicating the length of its payload (<code>len</code>) followed 
by that many bytes of payload. The payload consists of the raw Modbus response as sent by the Slave Device
followed by 3 additional bytes: the first register/coil as <code>uint16</code> (big endian) and the number of 
registers/coils as <code>uint8</code> taken from the executed command. The following tables visualise the 
message structure. See the <a href="#examples">Examples</a> Section for some sample data messages explained down to 
the individual bytes. We also provide a <a href="#reference-decoder">Reference Decoder</a> in JavaScript that can read
the format.</p>
<p>The timestamp in the message is the wakeup time when the device was activated by the cron expression in <code>MbCron</code>
(using the devices internal clock). The Modbus Response in the message in addition with the start register/coil and 
the register/coil count makes it possible to know which registers/coils where exactly read/written, what kind 
they were, and the address of the device. For Modbus Commands that do not have a register/coil count (like 
function 5, forcing a single coil), or for those that do not contain a start register/coil (e.g. funtion 7, 
reading exception status), the contents of the additional fields <code>start register</code> and/or <code>count</code> are undefined. 
The payload format used only a single byte for the count value, so if you are reading/writing more than 
255 coils, the higher byte will be cut off.</p>
<p>The Bridge puts as many responses as in one message as possible (without changing the order of responses and
respecting the maximal message size of the current <a href="../../background/lorawan.html#spreading-factor">Spreading Factor</a>).
If the responses do not fit into a single message it will upload as many messages as needed. When a single response 
is too long to fit in a message, the response will be split up over multiple messages and will need to be 
reassembled in the backend. See <a href="#split-messages">Split Messages</a> for instructions on how to do that and how 
to prevent splitting.</p>
<p>Structure of a message on port 3:
<div class="highlight"><pre><span></span><code>Bytes  | 0 . 1 . 2 . 3 . 4 | 5 ...      | ...        | ... | ...        |
       +-------------------+------------+------------+-----+------------+
Part   | timestamp         | response 1 | response 2 | ... | response n |
</code></pre></div></p>
<p>Structure of a response part on port 3:
<div class="highlight"><pre><span></span><code>Bytes  | 0   | 1 .. len-3      | len-2 . len-1  | len   |
       +-----+-----------------+----------------+-------+
Field  | len | Modbus response | start register | count |
</code></pre></div></p>
<h5 id="compact-payload-format">Compact payload format</h5>
<p>The compact payload format transmits only the payload bytes of the received responses. This format requires 
less bytes to upload the information than the verbose payload format, allowing more data to be read out 
per hour, but it requires a customised backend that knows the exact configuration of the Bridge. This format 
only makes sense for reading registers/coils. Error conditions can not be communicated very well using this 
format.</p>
<p>For <code>PlFmt</code>=<code>2</code> the data messages are uploaded on port 6. The messages start with a 5 byte timestamp
(same as in verbose payload format). The timestamp is followed by only the payload bytes of the 
Modbus Responses triggerd by the configuration parameter <code>MbCmd</code>. The bytes are just appended to the 
message after another, in the order of the Commands in <code>MbCmd</code>. You will need to know the exact 
value of <code>MbCmd</code> of each of your Bridges to make sense of the data. When using this payload format the 
<a href="#remote-configuration">Remote Configuration</a> is very helpful: it can be used to read the value of
configuration parameters over LoRaWAN without physical access to the device (it can also change those values).
If a Modbus command fails to execute (for example if the Slave device has a power outage or if the bus is 
disconnected), the data bytes of that command are all set to <code>0xff</code>. This could also be a valid 
value (depending on the nature of your data), but there is no other channel to communicate failure.
<code>0xff</code> is easy to spot and <code>0xffff</code> is relative unlikely to be a real value for Modbus registers. </p>
<p>When using the Bridge with <code>PlFmt</code>=<code>3</code> data messages are uploaded on port 7. The payload format is 
identical to the payload format for <code>PlFmt</code>=<code>3</code> only without the timestamp (to save another 5 bytes in case 
you do not care about the time of your readings).</p>
<h4 id="split-messages">Split messages</h4>
<p>LoRaWAN has a very limited message size. For high spreading factors this goes 
as low as 51 bytes. If a Modbus Response is too long to fit into a single 
message, the Modbus Bridge will split it up into multiple messages that are 
sent in sequence. Patching messages back together requires a more complex 
backend that can save a state. A simple parse on <em>The Things Network</em> will not 
be able to do that. If your backend cannot handle this process, you can work 
around it by configuring your <code>MbCmd</code> in a way that no single response will 
be longer than 45 bytes (by reading out a maximum of 24 consecutive registers in 
a single command). If you have a configuration that results in longer Responses
you should make sure your backend can handle split Responses as described here.</p>
<p>If a Response is too long to fit into a single message, the Bridge puts as many 
bytes as possible into the message. You can tell by the length of the message
and the length of the Modbus Response indicated in the message, that this is 
only the first part of a message. This first part will be upload normally on 
port 3 (or port 4, if triggered by a downlink). Following the first part, the 
Bridge will upload the remaining data in messages sent on port 5. For very long 
Responses and high Spreading Factors, the Response could be split into up to 
6 messages. You can use the frame counter and the indicated length to verify 
if you receive all parts.</p>
<p>Modbus Responses that are split up will never be packed together with other 
Responses. The <a href="#examples">Examples</a> section contains an illustration of 
a split up Response.</p>
<h3 id="downlink">Downlink</h3>
<p>Please be aware that Downlinks in LoRaWAN can only be received when the device 
sends an Uplink, or when the device operates in Class C mode.
See <a href="/background/lorawan.html#uplinks-and-downlinks">Uplinks and Downlinks</a> in 
our LoRaWAN page for more information.</p>
<h4 id="modbus-commands_1">Modbus Commands</h4>
<p>Downlinks on port 4 contain one or more Modbus Commands that the Bridge should 
forward to the RS-485 bus. Every Command must be prefixed by a single byte 
defining the Command's length as <code>uint8</code>. The Modbus Commands must be sent as
<strong>raw bytes</strong> and without any check digits.</p>
<p>The Responses to the Commands are sent as 
Uplink messages on port 4. The payload format on port 4 is the same as on port 3 
(see <a href="#data-messages">Data messages</a>), only that the timestamp indicates the 
time the downlink was received by the Bridge.</p>
<p>Any byte sequence can transmitted this way and will be forwarded to the bus. 
If the Bridge does not receive a Response by the addressed Slave Device, it creates an 
error Response with the exception code <code>11</code> "Gateway Target Device Failed to Respond". 
This only makes sense if the Downlink did contain a Modbus Command, but it will be 
performed for any sequence of bytes you send. Commands must have a length of at least 
3 bytes.</p>
<p>Please be advised that not all Modbus Slave devices send Responses in all cases. If 
you receive the exception code <code>11</code> it is possible that the Slave device was reached 
but was not addressed correctly. It might even be possible, that a Command was 
executed successfully, but that the device does not send confirmations. When in doubt, 
refer to the documentation of your connected devices or try communicating with it 
directly from your computer or using the <a href="#dialog-mode">Dialog Mode</a>, to reduce possible error sources.</p>
<p>Refer to <a href="#examples">Examples</a> to see some Downlinks and their answers.</p>
<h4 id="remote-configuration">Remote Configuration</h4>
<p>The Modbus Bridge supports configuration via LoRaWAN Downlinks. It receives commands 
on port 128. See <a href="/background/lorawan.html#remote-configuration">Remote Configuration</a>
in our LoRaWAN page for instructions on how to use it.</p>
<h2 id="examples">Examples</h2>
<p>This chapter illustrates with some examples, how working with the Modbus Bridge 
looks like. The bytes that are sent via LoRaWAN are presented here as hex strings,
while on the air they are sent as raw bytes.
Modbus Commands and Responses are broken down to their parts in the 
explanations, but explaining the format used by Modbus in detail is beyond the 
scope of this manual. You can find a short explanation on Modbus on Wikipedia: 
<a href="https://en.wikipedia.org/wiki/Modbus">https://en.wikipedia.org/wiki/Modbus</a>.</p>
<h3 id="uplinks-triggered-by-configuration">Uplinks triggered by configuration</h3>
<p>The following shows some examples of configuration for the automated reading and 
what the generated Uplinks for that could look like.</p>
<p><strong>Example A1: Read Holding Registers 0, 1, and 2 of device with address 1</strong>
<div class="highlight"><pre><span></span><code>MbCmd = &#39;010300000003&#39;

# Example resulting Uplink after successful readout
Up, Port 3: &#39;005d1698fd0c0103061234567890ab000003&#39;
 &#39;005d1698fd&#39; -&gt; timestamp = 1561762045 -&gt; 2019-06-28T22:47:25 UTC
 &#39;0c&#39;       -&gt; first Response is 12 bytes long
 &#39;0103061234567890ab000003&#39; 12 bytes modbus response:
   &#39;01&#39; -&gt; slave device with address 1
   &#39;03&#39; -&gt; function 3 = read Holding Register, success
   &#39;06&#39; -&gt; 6 bytes of data in Response following
   &#39;1234567890ab&#39; -&gt; 6 bytes of data
   &#39;0000&#39; -&gt; start reading at register 0
   &#39;03&#39; -&gt; read 3 consecutive registers

# Example resulting Uplink after failing readout
Up, Port 3: &#39;005d1698fd0601830b000003&#39;
 &#39;005d1698fd&#39; -&gt; timestamp = 1561762045 -&gt; 2019-06-28T22:47:25 UTC
 &#39;06&#39;       -&gt; first Response is 6 bytes long
 &#39;01830b000003&#39; 3 bytes modbus response:
   &#39;01&#39; -&gt; slave device with address 1
   &#39;83&#39; -&gt; function 3 with error indicator 80 = read Holding Register, failed
   &#39;0b&#39; -&gt; error code 11: &quot;Gateway Target Device Failed to Respond&quot;
   &#39;0000&#39; -&gt; start reading at register 0
   &#39;03&#39; -&gt; read 3 consecutive registers
</code></pre></div></p>
<p><strong>Example A2: Read coils 1000-1019 of device 32</strong>
<div class="highlight"><pre><span></span><code>MbCmd = &#39;200103e80014&#39;

# Example resulting Uplink
Up, Port 3: &#39;005d1698fd 09 200103f1041a03e814&#39;
 &#39;005d1698fd&#39; -&gt; timestamp = 1561762045 -&gt; 2019-06-28T22:47:25 UTC
 &#39;09&#39;       -&gt; first Response is 9 bytes long
 &#39;200103f1041a03e814&#39; 9 bytes of response:
   &#39;20&#39; -&gt; slave device with address 32
   &#39;01&#39; -&gt; read coils, success
   &#39;03&#39; -&gt; 3 bytes of data
   &#39;f1041a&#39; -&gt; 20 bits of data packed into 3 bytes
   &#39;03e8&#39; -&gt; start reading at coil 1000
   &#39;14&#39; -&gt; read 20 consecutive coils
</code></pre></div></p>
<p><strong>Example A3: Read two devices</strong>
<div class="highlight"><pre><span></span><code>MbCmd = &#39;0a0300010005,3001ea600020&#39;

# Example resulting Uplink
Up, Port 3: &#39;005d1698fd100a030a111122223333444455550001050a30010412345678ea6020&#39;
 &#39;005d1698fd&#39; -&gt; timestamp = 1561762045 -&gt; 2019-06-28T22:47:25 UTC
 &#39;10&#39; -&gt; first Response is 16 bytes long
 &#39;0a030a11112222333344445555000105&#39; 16 bytes of Response
   &#39;0a&#39; -&gt; slave device with address 10
   &#39;03&#39; -&gt; read Holding Registers, success
   &#39;0a&#39; -&gt; 10 bytes of data following
   &#39;11112222333344445555&#39; 10 bytes of data
   &#39;0001&#39; -&gt; start reading at register 1
   &#39;05&#39; -&gt; read 5 registers
 &#39;0a&#39; -&gt; second Response is 10 bytes long
 &#39;30010412345678ea6020&#39; 10 bytes of Response
   &#39;30&#39; -&gt; slave device with address 48
   &#39;01&#39; -&gt; read Coils, success
   &#39;04&#39; -&gt; 4 bytes of data following
   &#39;12345678&#39; -&gt; 32 bits of data packed in 4 bytes
   &#39;ea60&#39; -&gt; start at coil 60000
   &#39;20&#39; -&gt; read 32 coils
</code></pre></div></p>
<p><strong>Example A4: Split up messages</strong>
<div class="highlight"><pre><span></span><code>MbCmd = &#39;010300010020&#39;
# Command reads 32 consecutive registers resulting in 64 bytes payload

# Example resulting Uplinks for a Spreading Factor of 12 with 51 bytes of payload per message
Up 1, Port 3: &#39;005d1698fd46010340000100020003000400050006000700080009000a000b000c000d000e000f001000110012001300140015&#39;
  &#39;005d1698fd&#39; -&gt; timestamp = 1561762045 -&gt; 2019-06-28T22:47:25 UTC
  &#39;46&#39; -&gt; first Response is 70 bytes long
  since the remainder of the message does not contain 70 bytes, you know there must be an additional part comming 
Up 2, Port 5: &#39;0016001700180019001a001b001c001d001e001f00200120&#39;
  This contains the rest of the message. Appended to the privious message, it adds up to the correct number of bytes.
</code></pre></div></p>
<div class="admonition info">
<p class="admonition-title">TODO: examples for compact payload format</p>
<p>All this examples use the verbose payload format. We need to add examples using the compact format.</p>
</div>
<h3 id="uplinks-triggered-by-downlink-commands">Uplinks triggered by Downlink Commands</h3>
<p><strong>Example B1: Read single Input Register by Downlink</strong>
<div class="highlight"><pre><span></span><code>Down, Port 4: &#39;06180401000001&#39;
  &#39;06&#39; -&gt; first Command is 6 bytes long
  &#39;180401000001&#39; 6 bytes of Modbus Command
    &#39;18&#39; -&gt; slave device with address 24
    &#39;04&#39; -&gt; function 4, read Input Register
    &#39;0100&#39; -&gt; start at register 256
    &#39;0001&#39; -&gt; read 1 register

# Example resulting Uplink
Up, Port4: &#39;004b3dd67508180402abcd010001&#39;
  &#39;004b3dd675&#39; -&gt; timestamp = 1262343797 -&gt; 2010-01-01T11:03:17 UTC
  &#39;08&#39; -&gt; first Response is 8 bytes long
  &#39;180404abcd010001&#39; 8 bytes of Response
    &#39;18&#39; -&gt; slave device with address 24
    &#39;04&#39; -&gt; read Input Register, success
    &#39;02&#39; -&gt; 2 bytes of data following
    &#39;abcd&#39; -&gt; 2 bytes of data
    &#39;0100&#39; -&gt; start at register 256
    &#39;01&#39; -&gt; read 1 register
</code></pre></div></p>
<p><strong>Example B2: Writing holding registers on multiple devices</strong>
<div class="highlight"><pre><span></span><code>Down, Port 4: &#39;06a106aabb12340fa210a0010004081122334455667788&#39;
  &#39;06&#39; -&gt; first Command is 6 bytes long
  &#39;a106aabb1234&#39; 6 bytes of Modbus Command
    &#39;a1&#39; -&gt; slave device with address 161
    &#39;06&#39; -&gt; function 6, write single Holding Register
    &#39;aabb&#39; -&gt; address of Register to write = 43707
    &#39;1234&#39; -&gt; two bytes of data
  &#39;0f&#39; -&gt; second Command is 15 byts long
  &#39;a210a0010004081122334455667788&#39; 15 byte of Modbus Command
    &#39;a2&#39; -&gt; slave device with address 162
    &#39;10&#39; -&gt; function 16, write multiple Holding Registers
    &#39;a001&#39; -&gt; start at register 40961
    &#39;0004&#39; -&gt; 4 registers to write
    &#39;08&#39; -&gt; 8 bytes of data follow
    &#39;1122334455667788&#39; -&gt; 8 bytes of data

# Example resulting Uplink
Up, Port 4: &#39;004b3dd67506a1860200000006a210a0010004&#39;
  &#39;004b3dd675&#39; -&gt; timestamp = 1262343797 -&gt; 2010-01-01T11:03:17 UTC
  &#39;06&#39; -&gt; first Response is 3 bytes long
  &#39;a18602000000&#39; 3 bytes of Modbus Response
    &#39;a1&#39; -&gt; slave device address 161
    &#39;86&#39; -&gt; write single Holding Regsiter, failed
    &#39;02&#39; -&gt; error code 2: &quot;Illegal Data Address&quot;
    &#39;0000&#39; -&gt; start register not used (undefined)
    &#39;00&#39; -&gt; count not used (undefined)
  &#39;06&#39; - second Response is 6 byts long
  &#39;a210a0010004&#39; 6 bytes od Modbus Response
    &#39;a2&#39; -&gt; slave device address 162
    &#39;10&#39; -&gt; write multiple Holding Registers, success
    &#39;a001&#39; -&gt; start at register 40961
    &#39;0004&#39; -&gt; 4 registers to write
</code></pre></div></p>
<h2 id="dialog-mode">Dialog Mode</h2>
<p>The Modbus Bridge has an additional interactive Operation Mode that can help 
finding the correct Modbus Commands for normal operations. You enter it by 
setting the Configuration Parameter <code>DialogMode</code> to <code>true</code> using the Lobaro 
Configuration Adapter and the Lobaro Maintenance Tool. After saving the 
configuration the device will reboot and enter Dialog Mode. To change the device 
back to normal operations change the Parameter <code>DialogMode</code> back to <code>false</code> and 
save the config.</p>
<p>In Dialog Mode the Bridge will not connect to the LoRaWAN Network and it will 
not execute any operations on its own. It will wait for user input over the 
Lobaro Maintenance Tool. On the tab showing the device's log messages there is 
an input field labeled <em>Send via UART</em>. You can enter Modbus commands here, 
followed by pressing return. The Bridge will send the commands over the bus 
just as it would if it got them from configuration. The response will be 
observable in the Log.</p>
<p>The Commands must be entered as hex strings without any check sums. The Modbus 
parameters (UART configuration and Modbus Mode RTU/ASCII) are taken from the 
configuration just as during normal operations. The Bridge operates as an 
interactive Modbus master device that can be used for diagnosing Modbus installations 
or executing a few commands on a device that has no permanent Modbus connection.</p>
<div class="admonition warning">
<p class="admonition-title">In Dialog Mode the device does not enter any sleep states.</p>
<p>If you leave the Modbus Bridge in DialogMode while it is powered by battery
it will quickly drain the battery and run out of power.</p>
</div>
<h3 id="dialog-mode-example">Dialog Mode Example</h3>
<div class="highlight"><pre><span></span><code>Command sent via UART:
&#39;010300100002&#39;
Read Holding Registers #16 and #17 from slave device with address 1.

Possible Responses:
&#39;01830b&#39; -&gt; 
    Device did not respond or could not be reached 
    (error code 11, generated by Bridge)

&#39;018302&#39; -&gt; 
    Reading holding registers with that addresses not supported by device 
    (error code 2, generated by Slave device with address 1)

&#39;010300100002abcd1234&#39; -&gt;
    Successful readout of registers:
    register #16: &#39;abcd&#39;
    register #17: &#39;1234&#39;
</code></pre></div>

<h2 id="complex-setups">Complex setups</h2>
<p>The Modbus Bridge as described in this manual can be individually configured to read out any
registers and coils. For some setups, this is not enough. There can be situations in which you want
to read registers at different intervals, e.g. you might need some values with hourly updates
and others only every other day. For measuring values with high variance it can be necessary
to take multiple reads over a period of time and create an average value. Maybe you need
to read a status register first and depending on its value you want to decide which registers
to read and transmit the values of. 
All this scenarios are possible to solve using the Modbus Bridge, but their complexity leave the
scope of our standard firmware. If you need any special processing for your Modbus setup,
please contact us with your requirements, and we will make you an offer for an individual
firmware that processes data the way you need.
If you find that the data rate LoRaWAN offers is a limitation for your setup, we could also
provide you with a Modbus solution that uses alternate data transmission technologies, for
example NarrowBand-IoT.</p>
<h2 id="appendices">Appendices</h2>
<h3 id="technical-characteristics">Technical characteristics</h3>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Product</strong></td>
<td></td>
</tr>
<tr>
<td>Type name</td>
<td>Modbus485-LoRaWAN</td>
</tr>
<tr>
<td>Description</td>
<td>Modbus over LoRaWAN Bridge</td>
</tr>
<tr>
<td><strong>RF tranceiver</strong></td>
<td></td>
</tr>
<tr>
<td>Type</td>
<td>Semtech SX1272</td>
</tr>
<tr>
<td>Frequency</td>
<td>863 MHz to 870 MHz</td>
</tr>
<tr>
<td>Max. TX Power</td>
<td>max. +14 dBm</td>
</tr>
<tr>
<td>Typical RF Range</td>
<td>&le;2km</td>
</tr>
<tr>
<td>Ideal RF Range</td>
<td>&le;10km (free line of sight)</td>
</tr>
<tr>
<td><strong>LoRa communication</strong></td>
<td></td>
</tr>
<tr>
<td>Protocol</td>
<td>Class A / Class C LoRaWAN 1.1 EU868</td>
</tr>
<tr>
<td>Activation method</td>
<td>Over-the-air-activation (OTAA) <br> Activation by personalization (ABP)</td>
</tr>
<tr>
<td>Encryption</td>
<td>AES128</td>
</tr>
<tr>
<td><strong>Modbus communication</strong></td>
<td></td>
</tr>
<tr>
<td>Bus</td>
<td>RS-485 twisted pair wires (with optional GND)</td>
</tr>
<tr>
<td>Protocol</td>
<td>RTU/ASCII</td>
</tr>
<tr>
<td><strong>Environmental Requirements</strong></td>
<td></td>
</tr>
<tr>
<td>Operating temperature</td>
<td>-20C &ndash; 55C</td>
</tr>
<tr>
<td>Max installation height</td>
<td>2m</td>
</tr>
<tr>
<td><strong>Standards</strong> <br> <img title="CE" alt="CE logo" src="/img/symbol-ce.svg" height="60"> <img title="weee" title="weee logo" src="/img/symbol-weee.svg" height="60"></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="ce-declaration-of-conformity">CE Declaration of Conformity</h3>
<p><a href="files/ce-Modbus485-lorawan.pdf">CE Declaration of Conformity</a> (pdf).</p>
<h3 id="disposal-weee-entsorgung">Disposal / WEEE / Entsorgung</h3>
<p><a href="/background/weee-disposal">Information about the disposal of the Device</a>.</p>
<h3 id="reference-decoder">Reference decoder</h3>
<p>This is a decoder written in JavaScript that can be used to parse the device's 
LoRaWAN messages. It can be used as is in 
<a href="https://thethingsnetwork.org">The Things Network</a>.</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">function</span> <span class="nx">readVersion</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span> <span class="o">|</span>
        <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">uint16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">port1</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="nx">readVersion</span><span class="p">(</span><span class="nx">bytes</span><span class="p">),</span>
        <span class="s2">&quot;flags&quot;</span><span class="o">:</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;temp&quot;</span><span class="o">:</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;vBat&quot;</span><span class="o">:</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s2">&quot;operationMode&quot;</span><span class="o">:</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span>
        <span class="s2">&quot;noData&quot;</span><span class="o">:</span> <span class="o">!!</span><span class="p">(</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">port2</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">regs</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// loop through data packs</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;device&quot;</span><span class="o">:</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;register&quot;</span><span class="o">:</span><span class="nx">int16_BE</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="o">:!!</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">),</span>
                <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="kc">null</span>
            <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">dataLen</span> <span class="o">=</span> <span class="nx">r</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">dataLen</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">r</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">dataLen</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">regs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="nx">dataLen</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;registers&quot;</span><span class="o">:</span> <span class="nx">regs</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">modbusErrorString</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Modbus exception codes</span>
    <span class="c1">// see https://en.wikipedia.org/wiki/Modbus#Exception_responses</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Illegal Function&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Illegal Data Address&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Illegal Data Value&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Slave Device Failure&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Acknowledge&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Slave Device Busy&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">7</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Negative Acknowledge&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">8</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Memory Parity Error&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">10</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Gateway Path Unavailable&quot;</span><span class="p">;</span>
        <span class="k">case</span> <span class="mi">11</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Gateway Target Device Failed to Respond&quot;</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="k">return</span> <span class="s2">&quot;Unknown error code&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">parseModbusPayloadRegisters</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">byteCnt</span> <span class="o">=</span> <span class="nx">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="nx">byteCnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">vals</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">byteCnt</span><span class="p">;</span> <span class="nx">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">vals</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="o">+</span><span class="nx">payload</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="o">+</span><span class="nx">payload</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]])</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">vals</span><span class="p">;</span>

<span class="p">}</span>
<span class="kd">function</span> <span class="nx">parseModbusResponse</span><span class="p">(</span><span class="nx">raw</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">resp</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">raw</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="nx">raw</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">rawResp</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">raw</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;slave&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fun</span><span class="p">;</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">uint16_BE</span><span class="p">(</span><span class="nx">raw</span><span class="p">,</span> <span class="nx">raw</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;cnt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="nx">raw</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
        <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;raw&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">rawResp</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;errorCode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">raw</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
            <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;errorText&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">modbusErrorString</span><span class="p">(</span><span class="nx">raw</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">resp</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parseModbusPayloadRegisters</span><span class="p">(</span><span class="nx">rawResp</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
            <span class="c1">// TODO: coils</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">resp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">FullResponses</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">resps</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">pos</span> <span class="o">&lt;</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">respLen</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">[</span><span class="nx">pos</span><span class="o">++</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">pos</span> <span class="o">+</span> <span class="nx">respLen</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">rawResponse</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">pos</span> <span class="o">+</span> <span class="nx">respLen</span><span class="p">);</span>
            <span class="nx">resps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">parseModbusResponse</span><span class="p">(</span><span class="nx">rawResponse</span><span class="p">));</span>
            <span class="nx">pos</span> <span class="o">+=</span> <span class="nx">respLen</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="nx">port</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span> <span class="o">:</span> <span class="nx">timestamp</span><span class="p">,</span>
        <span class="s2">&quot;responses&quot;</span><span class="o">:</span> <span class="nx">resps</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">bin2String</span><span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nb">String</span><span class="p">.</span><span class="nx">fromCharCode</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ConfigResponse</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">bin2String</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;response&quot;</span> <span class="o">:</span> <span class="nx">t</span><span class="p">,</span>
        <span class="s2">&quot;error&quot;</span> <span class="o">:</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;!&#39;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * TTN decoder function.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="c1">// Status message:</span>
            <span class="k">return</span> <span class="nx">port1</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
            <span class="c1">// not legacy format:</span>
            <span class="k">return</span> <span class="nx">port2</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
        <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
        <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
            <span class="c1">// v1.0.0 format, full modbus responses:</span>
            <span class="k">return</span> <span class="nx">FullResponses</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>
        <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
            <span class="c1">// continuation of previous response:</span>
            <span class="k">return</span> <span class="p">{};</span>
        <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
            <span class="c1">// dense format with prefixed timestamp:</span>
            <span class="k">return</span> <span class="p">{};</span>
        <span class="k">case</span> <span class="mi">7</span><span class="o">:</span>
            <span class="c1">// dense format without timestamp:</span>
            <span class="k">return</span> <span class="p">{};</span>
        <span class="k">case</span> <span class="mi">128</span><span class="o">:</span>
            <span class="k">return</span> <span class="nx">ConfigResponse</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;invalid port&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="nx">port</span><span class="p">};</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * LoRaServer decoder function.</span>
<span class="cm"> */</span>
<span class="kd">function</span> <span class="nx">Decode</span><span class="p">(</span><span class="nx">fPort</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// wrap TTN Decoder:</span>
    <span class="k">return</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">fPort</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">Parse</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">(</span><span class="nx">atob</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">data</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fPort</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">fcnt</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">fCnt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">vals</span> <span class="o">=</span>  <span class="nx">Decoder</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>
    <span class="nx">vals</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">port</span><span class="p">;</span>
    <span class="nx">vals</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="nx">vals</span><span class="p">[</span><span class="s2">&quot;fnct&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fcnt</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">lastFcnt</span> <span class="o">=</span> <span class="nx">Device</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">(</span><span class="s2">&quot;lastFcnt&quot;</span><span class="p">);</span>
    <span class="nx">vals</span><span class="p">[</span><span class="s2">&quot;reset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fcnt</span> <span class="o">&lt;=</span> <span class="nx">lastFcnt</span><span class="p">;</span>
    <span class="nx">Device</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="s2">&quot;lastFcnt&quot;</span><span class="p">,</span> <span class="nx">fcnt</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">vals</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<a href="http://www.modbus.org" target="_blank">Copyright Modbus Logo</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../wmbus-lorawan/firmware.html" title="Firmware & Changelog" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Firmware & Changelog
              </div>
            </div>
          </a>
        
        
          <a href="firmware.html" title="Firmware & Changelog" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Firmware & Changelog
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Lobaro GmbH
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../js/mermaid.min.js"></script>
      
        <script src="../../js/simple-lightbox.js"></script>
      
    
  </body>
</html>