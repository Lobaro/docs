



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Online documentation of the Lobaro GmbH, Industrial IoT Solutions. Manuals for our IoT Devices.">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Lobaro Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Cousine&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Cousine","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../css/lobarodoc.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-69919312-3", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="white" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#modbus-ascii-rtu-over-lorawan-bridge" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../index.html" title="Lobaro Documentation" class="md-header-nav__button md-logo">
          
            <img src="../../../img/lobaro-rings-circle.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Lobaro Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Modbus (ASCII / RTU) over LoRaWAN Bridge
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/lobaro/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../../../index.html" title="Lobaro Documentation" class="md-nav__button md-logo">
      
        <img src="../../../img/lobaro-rings-circle.svg" width="48" height="48">
      
    </a>
    Lobaro Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/lobaro/docs/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../hardware.html" title="Hardware Variations" class="md-nav__link">
      Hardware Variations
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      LoRaWAN Sensors
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        LoRaWAN Sensors
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      wMBUS Bridge
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        wMBUS Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../wmbus-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../wmbus-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Modbus Bridge
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Modbus Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../versions.html" title="Versions" class="md-nav__link">
      Versions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      EDL21 Bridge
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        EDL21 Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../edl21-opto-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../edl21-opto-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      1-Wire Bridge
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        1-Wire Bridge
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../1-wire-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../1-wire-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-5" type="checkbox" id="nav-3-5">
    
    <label class="md-nav__link" for="nav-3-5">
      GPS Tracker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-5">
        GPS Tracker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../gps-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../gps-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-6" type="checkbox" id="nav-3-6">
    
    <label class="md-nav__link" for="nav-3-6">
      Usonic Distance Sensor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-6">
        Usonic Distance Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../usonic-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../usonic-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Temp. + rH. Sensor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Temp. + rH. Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../humidity-temp-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../humidity-temp-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      Pressure Sensor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        Pressure Sensor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../pressure-lorawan/index.html" title="Manual" class="md-nav__link">
      Manual
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pressure-lorawan/firmware.html" title="Firmware & Changelog" class="md-nav__link">
      Firmware & Changelog
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../dashboard/index.html" title="Lobaro Dashboard" class="md-nav__link">
      Lobaro Dashboard
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Lobaro Tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Lobaro Tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/lobaro-tool.html" title="Lobaro Maintenance Tool" class="md-nav__link">
      Lobaro Maintenance Tool
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tools/usb-config-adapter.html" title="USB Config Adapter" class="md-nav__link">
      USB Config Adapter
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Knowledge base
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Knowledge base
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../background/cron-expressions.html" title="CRON Expressions" class="md-nav__link">
      CRON Expressions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../background/lorawan.html" title="LoRaWAN" class="md-nav__link">
      LoRaWAN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../background/obis-codes.html" title="OBIS Codes" class="md-nav__link">
      OBIS Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../background/weee-disposal.html" title="WEEE Disposal" class="md-nav__link">
      WEEE Disposal
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://www.lobaro-shop.com/" title="Online Shop" class="md-nav__link">
      Online Shop
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://www.lobaro.com/" title="Company Home (DE)" class="md-nav__link">
      Company Home (DE)
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://www.lobaro.com/contact/" title="Contact / Impressum" class="md-nav__link">
      Contact / Impressum
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#target-measurement-purpose" class="md-nav__link">
    Target Measurement / Purpose
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#work-cycle" class="md-nav__link">
    Work Cycle
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lorawan-parameters" class="md-nav__link">
    loRaWAN Parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modbusuart" class="md-nav__link">
    Modbus/UART
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operation" class="md-nav__link">
    Operation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registercoil-definition" class="md-nav__link">
    Register/Coil definition
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-register-definition-strings" class="md-nav__link">
    Example register definition strings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#payload-formats" class="md-nav__link">
    Payload formats
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#status-messages" class="md-nav__link">
    Status messages
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-messages" class="md-nav__link">
    Data messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structure-of-a-data-pack" class="md-nav__link">
    Structure of a data pack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complex-setups" class="md-nav__link">
    Complex setups
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#appendices" class="md-nav__link">
    Appendices
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#technical-characteristics" class="md-nav__link">
    Technical characteristics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ce-declaration-of-conformity" class="md-nav__link">
    CE Declaration of Conformity
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disposal-weee-entsorgung" class="md-nav__link">
    Disposal / WEEE / Entsorgung
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-decoder" class="md-nav__link">
    Reference decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/lobaro/docs/edit/master/docs/lorawan-sensors/modbus-lorawan/0.3.0/index.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="modbus-ascii-rtu-over-lorawan-bridge">Modbus (ASCII / RTU) over LoRaWAN Bridge</h1>
<p>Version v0.3.0</p>
<p><em>This manual is for an older version of the Modbus Bridge!</em> <br>
<a href="../">latest version</a> &ndash; <a href="../versions">version overview</a> </p>
<p><img alt="Modbus LoRaWAN Bridge on head rail" src="../files/modbus-lorawan-hatrail.jpg" style="width:40%;border:1px black solid;" /></p>
<div class="admonition info">
<p class="admonition-title">Consider using the latest firmware on your hardware</p>
<p>This version uses a different upload format than our newer versions. <br>
<a href="../firmware.html" target="_blank"><strong>See available firmware downloads</strong></a></p>
</div>
<h2 id="target-measurement-purpose">Target Measurement / Purpose</h2>
<p>The Lobaro Modbus LoRaWAN Bridge is a low power device that can be used to read values
out of a variety of other devices via Modbus (ASCII/RTU) over a RS-485 interface
and forward them over LoRaWAN, so that they can be accessed from an attached system.
Typical applications include reading out electric and water meters or retrieving
data from environmental sensors like temperature and humidity.</p>
<p><img alt="Modbus LoRaWAN Bridge" src="files/modbus-lorawan.png" style="width:50%; vertical-align: top;" /></p>
<p>The Modbus Bridge supports reading of all four object types that can be provided by 
Modbus slave devices: Coil, Discrete Input, Input Register, and Holding Register. 
Multiple different slave devices on the Bus can be accessed individually by a single 
Bridge device. Reading intervals and register definitions can be configured very 
flexibly to suit individual requirements.</p>
<p><strong>PDF Download</strong></p>
<ul>
<li><a href="files/Modbus-LoRaWAN-Specs.pdf">Data Sheet with dimensions</a></li>
</ul>
<h2 id="work-cycle">Work Cycle</h2>
<p>The Modbus LoRaWAN Bridge has a simple work cycle. It spends most of the time in a deep sleep 
state, to conserve energy. For every reading it wakes up for a few seconds, requests values 
from the connected slave devices, uploads the data via LoRaWAN, and then goes to sleep again.
The following flowchart illustrates the work cycle:</p>
<div class="mermaid">graph LR;
    init(Init)--&gt;check(Test Reading);
    check--&gt;join(LoRaWAN Join);
    join--&gt;read(Data Collection);
    read--&gt;send(Data Transfer);
    send--&gt;sleep("Sleep");
    sleep--&gt;|Cron expression| read;</div>

<dl>
<dt>Init</dt>
<dd>When the device starts (because it has just been connected to a power source, or after 
a reboot) it begins in the <em>Init</em> state. A quick self-check is executed; if that succeeds, 
the green on-board LED blinks once, slowly. After that the configuration is evaluated and 
checked for invalid values. If any problems are detected during <em>Init</em>, the device's LED 
will light up for three times, and the device will then reboot. If everything is okay, the 
device will continue with the <em>Test Reading</em>.</dd>
<dt>Test Reading</dt>
<dd></dd>
</dl>
<h2 id="configuration">Configuration</h2>
<p>The configuration is done using <a href="../../tools/lobaro-tool.md">Lobaro Maintenance Tool</a> and the Lobaro USB PC adapter.</p>
<h3 id="lorawan-parameters">loRaWAN Parameters</h3>
<p>The connection to the LoRaWAN network is defined by multiple configuration parameters.
This need to be set according to your LoRaWAN network and the way your device is 
supposed to be attached to it, or the device will not be able to send any data.</p>
<p>There are two different methods to attach a device to a LoRaWAN network: 
Over-the-air-activation (OTAA) and Activation-by-personalisation (ABP). 
Depending on which method you are using you will have to set different values.</p>
<p>Several values are a number of bytes, that need to be entered as hexstrings (without 
<code>0x</code>-prefix). So e.g. the DevEUI is a value of 8 bytes encoded in hex will be 
16 hexdigits long. A sample value would be <code>0123456789abcdef</code>.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>used</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OTAA</code></td>
<td>both</td>
<td>bool</td>
<td><code>true</code> &equiv; use OTAA, <code>false</code> &equiv; use ABP</td>
</tr>
<tr>
<td><code>DevEUI</code></td>
<td>OTAA</td>
<td>hexbyte[8]</td>
<td>the 8 byte DevEUI identifies the hardware on the join operation. The default value is a world wide unique value predefined in the hardware. Should not be changed unless required by the network provider.</td>
</tr>
<tr>
<td><code>AppEUI</code></td>
<td>OTAA</td>
<td>hexbyte[8]</td>
<td>ID defining the application used in the LoRaWAN network.</td>
</tr>
<tr>
<td><code>AppKey</code></td>
<td>OTAA</td>
<td>hexbyte[16]</td>
<td>Key used to encrypt communication with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>AppSKey</code></td>
<td>ABP</td>
<td>hexbyte[16]</td>
<td>Application Session Key to be synced with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>NetSKey</code></td>
<td>ABP</td>
<td>hexbyte[16]</td>
<td>Network Session Key to be synced with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>DevAdr</code></td>
<td>ABP</td>
<td>hexbyte[4]</td>
<td>Device Address used to identify device in the LoRaWAN network.</td>
</tr>
<tr>
<td><code>SF</code></td>
<td>both</td>
<td>int</td>
<td>Initial LoRa spreading factor used for transmissions. Valid range is 7-12. The actual spreading factor used by change during operation if ADR is used.</td>
</tr>
<tr>
<td><code>ADR</code></td>
<td>both</td>
<td>bool</td>
<td>Should adaptive data rate be used? <code>true</code> &equiv; use ADR, <code>false</code> &equiv; don't</td>
</tr>
</tbody>
</table>
<h3 id="modbusuart">Modbus/UART</h3>
<p>There are several values that define the configuration via Modbus. These 
values depend on the Slave devices that you want to read out. Please refer to your 
Modbus Devices's manual to find out the correct configuration.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th>values</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ModbusProtocol</code></td>
<td>Which Modbus-Protocol to use</td>
<td><code>RTU</code>. <code>ASCII</code></td>
</tr>
<tr>
<td><code>ModbusBaud</code></td>
<td>UART Baud rate</td>
<td><code>9600</code>, <code>19200</code>, <code>38400</code>, ...</td>
</tr>
<tr>
<td><code>ModbusDataLendth</code></td>
<td>UART data length</td>
<td><code>7</code>, <code>8</code>, <code>9</code></td>
</tr>
<tr>
<td><code>ModbusStopBits</code></td>
<td>UART stop bits</td>
<td><code>0.5</code>, <code>1</code>, <code>1.5</code>, <code>2</code> (written exactly like this)</td>
</tr>
<tr>
<td><code>ModbusParity</code></td>
<td>UART parity</td>
<td><code>NONE</code>, <code>EVEN</code>, <code>ODD</code></td>
</tr>
</tbody>
</table>
<h3 id="operation">Operation</h3>
<p>Configuration values defining the behaviour of the device. </p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th>example value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ModbusCron</code></td>
<td>Cron expression defining when to read</td>
<td><code>0 0/15 * * * *</code> for every 15 minutes</td>
</tr>
</tbody>
</table>
<p>See also our <a href="/background/cron-expressions">Introduction to Cron expressions</a>.</p>
<h3 id="registercoil-definition">Register/Coil definition</h3>
<p>Modbus defines four different object types form which values can be read:
Coils, Discrete Inputs, Input Registers, and Holding Registers.
For an introduction please refer to 
<a href="https://en.wikipedia.org/wiki/Modbus">https://en.wikipedia.org/wiki/Modbus</a>.
There are four configuration values to define which values should be read by 
the Modbus Bridge, one for each of the types. </p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th>Modbus Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Coils</code></td>
<td>Coils to read (single bit read-only values)</td>
<td><code>0x01</code></td>
</tr>
<tr>
<td><code>DiscreteInputs</code></td>
<td>Discrete Inputs to read (single bit read/write values)</td>
<td><code>0x02</code></td>
</tr>
<tr>
<td><code>HoldingRegisters</code></td>
<td>Holding Registers to read (2 byte read-only values)</td>
<td><code>0x03</code></td>
</tr>
<tr>
<td><code>InputRegisters</code></td>
<td>Input Register to read (2 byte read/write values)</td>
<td><code>0x04</code></td>
</tr>
</tbody>
</table>
<p>Each value can define multiple different registers/coils to be read on one or multiple 
devices connected via Modbus. The format is identical for all four types.</p>
<p>Each single definition consists of three values separated by colons (<code>:</code>). </p>
<ol>
<li>The address of the Modbus device that should be read from. Valid device addresses 
range from  1 to 247; with a single slave device on your bus this is often 1.</li>
<li>The address of the first register/coil to be read on the device. Register addresses 
are uint16 values and range from 0 to 65535.</li>
<li>The number of consecutive registers/coils to be read. This value is limited to 127, 
because longer answers cannot be encoded. Be aware that for registers a value higher 
than 22 leads to problems on high spreading factors so that the data will not 
be transferred completely via LoRaWAN.</li>
</ol>
<p>Multiple of these register definitions can be used if they are separated by 
commas (<code>,</code> no spaces after the comma).</p>
<p>You can use one or multiple of the register/coil types. If you do not want to use 
a type e.g. <code>Coils</code>, set that definition to an empty string. The device will parse 
the four register strings on startup and reports invalid definitions. The device 
will not work while there are invalid definitions but will reboot repeatedly until 
you fix the configuration.</p>
<h4 id="example-register-definition-strings">Example register definition strings</h4>
<table>
<thead>
<tr>
<th>definition</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>1:0:3</code></td>
<td>Read first three registers of device with address 1.</td>
</tr>
<tr>
<td><code>2:40001:1,2:2000:10</code></td>
<td>Read registers 40001 and 2000 to 2009 of device 2.</td>
</tr>
<tr>
<td><code>4:0:2,5:0:2,5:20:1</code></td>
<td>Read registers 0 and 1 of device 4 as well as registers 0, 1, and register 20 of device 5.</td>
</tr>
</tbody>
</table>
<h2 id="payload-formats">Payload formats</h2>
<p>The Modbus Bridge sends different kinds of messages over different LoRaWAN ports:</p>
<table>
<thead>
<tr>
<th align="right">Port</th>
<th align="left">Message</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">1</td>
<td align="left">Status messages.</td>
</tr>
<tr>
<td align="right">11</td>
<td align="left">Data from reading Coils (function <code>0x01</code>).</td>
</tr>
<tr>
<td align="right">12</td>
<td align="left">Data from reading Discrete Inputs (function <code>0x02</code>).</td>
</tr>
<tr>
<td align="right">13</td>
<td align="left">Data from reading Holding Registers (function <code>0x03</code>).</td>
</tr>
<tr>
<td align="right">14</td>
<td align="left">Data from reading Input Registers (function <code>0x04</code>).</td>
</tr>
</tbody>
</table>
<h4 id="status-messages">Status messages</h4>
<p>The Modbus Bridge sends a status messages report on the health of the device itself.
This messages are sent along when the device is sending data packages with a 
maximum of one status message per day. </p>
<p>Status messages are transmitted on port 1 and have a fixed length of 14 bytes.</p>
<table>
<thead>
<tr>
<th>name</th>
<th align="right">pos</th>
<th align="right">len</th>
<th>type</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr>
<td>version</td>
<td align="right">0</td>
<td align="right">3</td>
<td><code>uint8[3]</code></td>
<td>Version of firmware running on the device</td>
<td><code>[1, 0, 4]</code> &equiv; <code>v1.0.4</code></td>
</tr>
<tr>
<td>flag</td>
<td align="right">3</td>
<td align="right">1</td>
<td><code>uint8</code></td>
<td>Status flag, for internal use</td>
<td><code>0</code></td>
</tr>
<tr>
<td>temperature</td>
<td align="right">4</td>
<td align="right">2</td>
<td><code>int16</code></td>
<td>Device's internal temperature in tenth °C</td>
<td><code>246</code> &equiv; <code>24.6°C</code></td>
</tr>
<tr>
<td>voltage</td>
<td align="right">6</td>
<td align="right">2</td>
<td><code>int16</code></td>
<td>Voltage supplied by power source in mV</td>
<td><code>3547</code> &equiv; <code>3.547V</code></td>
</tr>
<tr>
<td>timestamp</td>
<td align="right">8</td>
<td align="right">5</td>
<td><code>int40</code></td>
<td>Internal date/time at creation of the status packet as UNIX timestamp</td>
<td><code>1533055905</code></td>
</tr>
<tr>
<td>mode</td>
<td align="right">13</td>
<td align="right">1</td>
<td><code>uint8</code></td>
<td>Operation mode the device runs</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
<h4 id="data-messages">Data messages</h4>
<p>The principle message format is equal for all four types of registers/coils. 
The port used defines what kind of register/coil was read 
(see table "Payload formats" above). The format slightly differs for coils versus 
registers, since the amount of data per coil (1 bit) is different than the amount 
per register (16 bits).</p>
<p>Each data message is starts with a 40 bit timestamp followed by one or more data packs.
Each pack represents a single read operation caused by a single register definition 
in your configuration. The pack starts with 4 bytes repeating the information of the 
register definition extended by a single bit reporting errors on reading
letting you know what data you are presented with and if it was read successfully). 
That information is followed by the raw data bytes as they where given by the 
slave device (as the Bridge cannot know how the data is presented in those bytes). 
The length of the data is dependent on the register definition and on the type 
(registers versus coils). The length is not explicitly stated, as it can be 
determined from the definition. The data bytes are also included when an error 
has occurred, however in this case the content of those bytes is undefined.</p>
<h6 id="structure-of-a-data-pack">Structure of a data pack</h6>
<table>
<thead>
<tr>
<th>name</th>
<th align="right">pos</th>
<th align="right">len</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>addr</td>
<td align="right">0</td>
<td align="right">1</td>
<td><code>uint8</code></td>
<td>Modbus address of slave device.</td>
</tr>
<tr>
<td>start</td>
<td align="right">1</td>
<td align="right">2</td>
<td><code>uint16</code></td>
<td>Address of first coil/register read.</td>
</tr>
<tr>
<td>cnt+err</td>
<td align="right">3</td>
<td align="right">1</td>
<td><code>uint8</code></td>
<td>Highest bit: error indicator, 7 lower bits: number of consecutive coils/registers read.</td>
</tr>
<tr>
<td>data</td>
<td align="right">4</td>
<td align="right">n</td>
<td><code>uint8[n]</code></td>
<td>Raw data bytes as sent by the slave device.</td>
</tr>
</tbody>
</table>
<p>To get <code>cnt</code>, the number of coils/registers read, you need to only read the lower 7 
bits of the fourth byte (e.g. by using something like <code>data[3] &amp; 0x7f</code>). The highest 
bit is <code>0</code> on successful reads and <code>1</code> if an error occurred. See our reference 
decoder if you have trouble reading the format.</p>
<p>The length of the data <code>n</code> for Coils and Discrete Inputs (Ports 11 and 12) the value 
of <code>cnt</code> divided by 8 rounded up (that is the minimal number of bytes needed to 
store <code>cnt</code> bits). For Registers (Ports 13 and 14) the data length is <code>cnt * 2</code>, since 
registers contain two bytes of data.</p>
<p>Please refer to the <em>reference decoder</em> usable in TTN at the end of this document.</p>
<h2 id="complex-setups">Complex setups</h2>
<p>The Modbus Bridge as described in this manual can be individually configured to read out any
registers and coils. For some setups, this is not enough. There can be situations in which you want
to read registers at different intervals, e.g. you might need some values with hourly updates
and others only every other day. For measuring values with high variance it can be necessary
to take multiple reads over a period of time and create an average value. Maybe you need
to read a status register first and depending on its value you want to decide which registers
to read and transmit the values of. You could also want to write values into registers with
the Bridge.
All this scenarios are possible to solve using the Modbus Bridge, but their complexity leave the
scope of our standard firmware. If you need any special processing for your Modbus setup,
please contact us with your requirements, and we will make you an offer for an individual
firmware that processes data the way you need.
If you find that the data rate LoRaWAN offers is a limitation for your setup, we could also
provide you with a Modbus solution that uses alternate data transmission technologies, for
example NarrowBand-IoT.</p>
<h2 id="appendices">Appendices</h2>
<h3 id="technical-characteristics">Technical characteristics</h3>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Product</strong></td>
<td></td>
</tr>
<tr>
<td>Type name</td>
<td>Modbus485-LoRaWAN</td>
</tr>
<tr>
<td>Description</td>
<td>Modbus over LoRaWAN Bridge</td>
</tr>
<tr>
<td><strong>RF tranceiver</strong></td>
<td></td>
</tr>
<tr>
<td>Type</td>
<td>Semtech SX1272</td>
</tr>
<tr>
<td>Frequency</td>
<td>863 MHz to 870 MHz</td>
</tr>
<tr>
<td>Max. TX Power</td>
<td>max. +14 dBm</td>
</tr>
<tr>
<td>Typical RF Range</td>
<td>&le;2km</td>
</tr>
<tr>
<td>Ideal RF Range</td>
<td>&le;10km (free line of sight)</td>
</tr>
<tr>
<td><strong>LoRa communication</strong></td>
<td></td>
</tr>
<tr>
<td>Protocol</td>
<td>Class A LoRaWAN 1.0.1 EU868</td>
</tr>
<tr>
<td>Activation method</td>
<td>Over-the-air-activation (OTAA) <br> Activation by personalization (ABP)</td>
</tr>
<tr>
<td>Encryption</td>
<td>AES128</td>
</tr>
<tr>
<td><strong>Modbus communication</strong></td>
<td></td>
</tr>
<tr>
<td>Bus</td>
<td>RS-485 twisted pair wires (with optional GND)</td>
</tr>
<tr>
<td>Protocol</td>
<td>RTU/ASCII</td>
</tr>
<tr>
<td><strong>Environmental Requirements</strong></td>
<td></td>
</tr>
<tr>
<td>Operating temperature</td>
<td>-20°C &ndash; 55°C</td>
</tr>
<tr>
<td>Max installation height</td>
<td>2m</td>
</tr>
<tr>
<td><strong>Standards</strong> <br> <img title="CE" alt="CE logo" src="/img/symbol-ce.svg" height="60"> <img title="weee" title="weee logo" src="/img/symbol-weee.svg" height="60"></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="ce-declaration-of-conformity">CE Declaration of Conformity</h3>
<p><a href="files/modbus-lorawan-ce-conformity.pdf">CE Declaration of Conformity</a> (pdf).</p>
<h3 id="disposal-weee-entsorgung">Disposal / WEEE / Entsorgung</h3>
<p><a href="/background/weee-disposal">Information about the disposal of the Device</a>.</p>
<h3 id="reference-decoder">Reference decoder</h3>
<p>This is a decoder written in JavaScript that can be used to parse the device's 
LoRaWAN messages. It can be used as is in 
<a href="https://thethingsnetwork.org">The Things Network</a>.</p>
<p><div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">readVersion</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="s2">&quot;v&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span> <span class="o">|</span>
        <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bytes</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">idx</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">decode_status</span><span class="p">(</span><span class="nx">bytes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="o">:</span><span class="nx">readVersion</span><span class="p">(</span><span class="nx">bytes</span><span class="p">),</span>
        <span class="s2">&quot;flags&quot;</span><span class="o">:</span><span class="nx">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="s2">&quot;temp&quot;</span><span class="o">:</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;vBat&quot;</span><span class="o">:</span> <span class="nx">int16_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
        <span class="s2">&quot;operationMode&quot;</span><span class="o">:</span> <span class="nx">bytes</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">decode_data</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fun</span> <span class="o">=</span> <span class="nx">port</span> <span class="o">-</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">regs</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">bytes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span><span class="o">&gt;=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;device&quot;</span><span class="o">:</span><span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;start&quot;</span><span class="o">:</span><span class="nx">int16_BE</span><span class="p">(</span><span class="nx">b</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s2">&quot;count&quot;</span><span class="o">:</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span>
                <span class="s2">&quot;error&quot;</span><span class="o">:!!</span><span class="p">(</span><span class="nx">b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">7</span><span class="p">),</span>
                <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="kc">null</span>
            <span class="p">};</span>
            <span class="kd">var</span> <span class="nx">dataLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">fun</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// coils, one bit per address</span>
                <span class="nx">dataLen</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">count</span><span class="o">/</span><span class="mf">8.0</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// registers, 16 bits per address</span>
                <span class="nx">dataLen</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">count</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="nx">dataLen</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">r</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="nx">dataLen</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">regs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
            <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="nx">dataLen</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;port&quot;</span><span class="o">:</span> <span class="nx">port</span><span class="p">,</span>
        <span class="s2">&quot;function&quot;</span><span class="o">:</span> <span class="nx">fun</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="o">:</span> <span class="nx">int40_BE</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;values&quot;</span><span class="o">:</span> <span class="nx">regs</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Decoder</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
            <span class="k">return</span> <span class="nx">decode_status</span><span class="p">(</span><span class="nx">bytes</span><span class="p">);</span>
        <span class="k">case</span> <span class="mi">11</span><span class="o">:</span>
        <span class="k">case</span> <span class="mi">12</span><span class="o">:</span>
        <span class="k">case</span> <span class="mi">13</span><span class="o">:</span>
        <span class="k">case</span> <span class="mi">14</span><span class="o">:</span>
            <span class="k">return</span> <span class="nx">decode_data</span><span class="p">(</span><span class="nx">bytes</span><span class="p">,</span> <span class="nx">port</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;invalid port&quot;</span><span class="p">,</span> <span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="nx">port</span><span class="p">};</span>
<span class="p">}</span>
</pre></div>
<a href="http://www.modbus.org" target="_blank">Copyright Modbus Logo</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Lobaro GmbH
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script>
      
        <script src="../../../js/mermaid.min.js"></script>
      
    
  </body>
</html>