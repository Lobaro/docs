<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Online documentation of the Lobaro GmbH, Industrial IoT Solutions. Manuals for our IoT Devices.">
    
    
    <link rel="../../img/favicon.ico">

    
    <title>EDL21 Electricity meter over LoRaWAN Bridge - Lobaro Documentation</title>
    

    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../../css/base.min.css" rel="stylesheet">
    <link href="../../css/cinder.min.css" rel="stylesheet">
    <link href="../../css/highlight.min.css" rel="stylesheet">
    <link href="../../css/lobarodoc.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    

     
</head>

<body class="homepage" >

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">Lobaro Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Documentation Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="https://www.lobaro.com/lobaro-iot-produkte-dienste/">Company Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="https://www.lobaro.com/contact/">Contact / Impressum</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/lobaro/docs/edit/master/docs/iot-devices/edl21-opto-lorawan/index.md"><i class="fab fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#edl21-electricity-meter-over-lorawan-bridge">EDL21 Electricity meter over LoRaWAN Bridge</a></li>
            <li class="second-level"><a href="#quickstart">Quickstart</a></li>
                
            <li class="second-level"><a href="#configuration">Configuration</a></li>
                
                <li class="third-level"><a href="#lorawan">LoRaWAN</a></li>
                <li class="third-level"><a href="#operation">Operation</a></li>
            <li class="second-level"><a href="#led-blinking-patterns-explained-in-the-order-in-which-they-appear">LED blinking patterns explained in the order in which they appear</a></li>
                
            <li class="second-level"><a href="#latest-firmware-download">Latest Firmware Download</a></li>
                
            <li class="second-level"><a href="#appendices">Appendices</a></li>
                
                <li class="third-level"><a href="#technical-characteristics">Technical characteristics</a></li>
                <li class="third-level"><a href="#disposal-weee-entsorgung">Disposal / WEEE / Entsorgung</a></li>
            <li class="second-level"><a href="#reference-decoder">Reference decoder</a></li>
                
                <li class="third-level"><a href="#example-parser-result">Example parser result</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="edl21-electricity-meter-over-lorawan-bridge">EDL21 Electricity meter over LoRaWAN Bridge</h1>
<p><img alt="Lobaro EDL21 LoRaWAN Bridge" src="edl21_small.jpg" /></p>
<h2 id="quickstart">Quickstart</h2>
<ol>
<li>Connect to the device with the <a href="https://www.lobaro.com/lobaro-maintenance-tool/">Lobaro Tool</a> using the <a href="https://www.lobaro-shop.com/product_info.php?info=p7_lobaro-usb-konfigurations-adapter.html">Lobaro Config Adapter</a> </li>
<li>Under Configuration click "Reload Config" and change the fields ReadCron and ObisCode as you need followed by clicking on "Write to Device" <a href="edl21_config_tool.jpg">click here for a configuration example</a></li>
<li>Register the device in your LoRaWAN network</li>
<li>Insert 2 batteries ('AA' size, 1.5V) / Connect external powersupply</li>
<li>If not connected to anything the red LED will start blinking as long as no data is received, after 1 minute it will sleep for 15 seconds after every 5 retries</li>
<li>Tighten the screws and install the bridge beside your electric meter</li>
<li>Place the EDL21 opto head on the "Info" interface</li>
<li>As soon as the EDL21 receives data its green LED will light up for 5 seconds, when connected to a LoRa Network its blue LED will light up for 5 seconds</li>
<li>Check the sent data (port 3), if payload is zero the EDL21 was not able to read data, recheck proper alignment</li>
</ol>
<h2 id="configuration">Configuration</h2>
<p>The configuration is done using <a href="/tools/lobaro-tool/">Lobaro Maintenance Tool</a> and the Lobaro USB PC adapter.</p>
<h3 id="lorawan">LoRaWAN</h3>
<p>The connection to the LoRaWAN network is defined by multiple configuration parameters.
This need to be set according to your LoRaWAN network and the way your device is 
supposed to be attached to it, or the device will not be able to send any data.</p>
<p>There are two different methods to attach a device to a LoRaWAN network: 
Over-the-air-activation (OTAA) and Activation-by-personalisation (ABP). 
Depending on which method you are using you will have to set different values.</p>
<p>Several values are a number of bytes, that need to be entered as hexstrings (without 
<code>0x</code>-prefix). So e.g. the DevEUI is a value of 8 bytes encoded in hex will be 
16 hexdigits long. A sample value would be <code>0123456789abcdef</code>.</p>
<table>
<thead>
<tr>
<th>name</th>
<th>used</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>OTAA</code></td>
<td>both</td>
<td>bool</td>
<td><code>true</code> &equiv; use OTAA, <code>false</code> &equiv; use ABP</td>
</tr>
<tr>
<td><code>DevEUI</code></td>
<td>OTAA</td>
<td>hexbyte[8]</td>
<td>the 8 byte DevEUI identifies the hardware on the join operation. The default value is a world wide unique value predefined in the hardware. Should not be changed unless required by the network provider.</td>
</tr>
<tr>
<td><code>AppEUI</code></td>
<td>OTAA</td>
<td>hexbyte[8]</td>
<td>ID defining the application used in the LoRaWAN network.</td>
</tr>
<tr>
<td><code>AppKey</code></td>
<td>OTAA</td>
<td>hexbyte[16]</td>
<td>Key used to encrypt communication with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>AppSKey</code></td>
<td>ABP</td>
<td>hexbyte[16]</td>
<td>Application Session Key to be synced with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>NetSKey</code></td>
<td>ABP</td>
<td>hexbyte[16]</td>
<td>Network Session Key to be synced with the LoRaWAN network.</td>
</tr>
<tr>
<td><code>DevAdr</code></td>
<td>ABP</td>
<td>hexbyte[4]</td>
<td>Device Address used to identify device in the LoRaWAN network.</td>
</tr>
<tr>
<td><code>SF</code></td>
<td>both</td>
<td>int</td>
<td>Initial LoRa spreading factor used for transmissions. Valid range is 7-12. The actual spreading factor used by change during operation if ADR is used.</td>
</tr>
<tr>
<td><code>ADR</code></td>
<td>both</td>
<td>bool</td>
<td>Should adaptive data rate be used? <code>true</code> &equiv; use ADR, <code>false</code> &equiv; don't</td>
</tr>
</tbody>
</table>
<h3 id="operation">Operation</h3>
<p>Configuration values defining the behaviour of the device. </p>
<table>
<thead>
<tr>
<th>name</th>
<th>description</th>
<th>example value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ReadCron</code></td>
<td>Cron expression defining when to read</td>
<td><code>0 0/15 * * * *</code> for every 15 minutes</td>
</tr>
<tr>
<td><code>ObisCode</code></td>
<td>Comma separated list of ObisCodes to select a subset of the available information</td>
<td><code>1-0:1.7.255*255</code> = Leistung (Momentan)</td>
</tr>
</tbody>
</table>
<p>See also our <a href="/background/cron-expressions">Introduction to Cron expressions</a> and our <a href="/background/obis-codes">Introduction to Obis Codes</a>.</p>
<h2 id="led-blinking-patterns-explained-in-the-order-in-which-they-appear">LED blinking patterns explained in the order in which they appear</h2>
<table>
<thead>
<tr>
<th>color</th>
<th>duration</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>red/green/blue</code></td>
<td>300ms each</td>
<td>initial pattern after reset</td>
</tr>
<tr>
<td><code>red</code></td>
<td>short, blinking</td>
<td>trying to receive meter optical data for the first time after reset</td>
</tr>
<tr>
<td><code>green</code></td>
<td>5 seconds</td>
<td>successfully received meter optical data</td>
</tr>
<tr>
<td><code>blue</code></td>
<td>5 seconds</td>
<td>LoRaWAN network join</td>
</tr>
<tr>
<td><code>blue</code></td>
<td>short</td>
<td>sending 1st LoRaWAN data</td>
</tr>
<tr>
<td><code>off</code></td>
<td>-</td>
<td>low-power mode until next sendout cycle</td>
</tr>
</tbody>
</table>
<p>As you can see by this the device will start the LoRaWAN join only after receiving optical data at least once.</p>
<h2 id="latest-firmware-download">Latest Firmware Download</h2>
<p><a href="http://files.lobaro.com/index.php/s/gd32WnADQLd7n2s">Download Firmware</a></p>
<h2 id="appendices">Appendices</h2>
<h3 id="technical-characteristics">Technical characteristics</h3>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Product</strong></td>
<td></td>
</tr>
<tr>
<td>Type name</td>
<td>EDL21-LoRaWAN</td>
</tr>
<tr>
<td>Description</td>
<td>Electricity meter over LoRaWAN Bridge</td>
</tr>
<tr>
<td><strong>RF tranceiver</strong></td>
<td></td>
</tr>
<tr>
<td>Type</td>
<td>Semtech SX1272</td>
</tr>
<tr>
<td>Frequency</td>
<td>863 MHz to 870 MHz</td>
</tr>
<tr>
<td>Max. TX Power</td>
<td>max. +14 dBm</td>
</tr>
<tr>
<td>Typical RF Range</td>
<td>&le;2km</td>
</tr>
<tr>
<td>Ideal RF Range</td>
<td>&le;10km (free line of sight)</td>
</tr>
<tr>
<td><strong>LoRa communication</strong></td>
<td></td>
</tr>
<tr>
<td>Protocol</td>
<td>Class A LoRaWAN 1.0.1 EU868</td>
</tr>
<tr>
<td>Activation method</td>
<td>Over-the-air-activation (OTAA) <br> Activation by personalization (ABP)</td>
</tr>
<tr>
<td>Encryption</td>
<td>AES128</td>
</tr>
<tr>
<td><strong>Environmental Requirements</strong></td>
<td></td>
</tr>
<tr>
<td>Operating temperature</td>
<td>-20°C &ndash; 55°C</td>
</tr>
<tr>
<td>Max installation height</td>
<td>2m</td>
</tr>
<tr>
<td><strong>Standards</strong> <br> <img title="CE" alt="CE logo" src="/img/symbol-ce.svg" height="60"> <img title="weee" title="weee logo" src="/img/symbol-weee.svg" height="60"></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="disposal-weee-entsorgung">Disposal / WEEE / Entsorgung</h3>
<p><a href="/background/weee-disposal">Information about the disposal of the Device</a>.</p>
<h2 id="reference-decoder">Reference decoder</h2>
<p>This is a decoder written in JavaScript that can be used to parse the device's 
LoRaWAN messages. It can be used as is in 
<a href="https://thethingsnetwork.org">The Things Network</a>.</p>
<pre class="highlight"><code>function readName(bytes, i) {
    return bytes.slice(i, i + 6);
}

function readValue(len, bytes, i) {
    if (len &lt;= 0) {
        return [];
    }
    return bytes.slice(i, i + len);
}

function toHexString(byteArray) {
    var s = '';
    byteArray.forEach(function (byte) {
        s += ('0' + (byte &amp; 0xFF).toString(16)).slice(-2);
    });
    return s;
}

function parse_int8(bytes, idx) {
    bytes = bytes.slice(idx || 0);
    var t = bytes[0];
    if ((t &amp; 1 &lt;&lt; 7) &gt; 0) { // temp is negative (16bit 2's complement)
        t = ((~t) &amp; 0xff) + 1; // invert 16bits &amp; add 1 =&gt; now positive value
        t = t * -1;
    }
    return t;
}

function parse_int16(bytes, idx) {
    bytes = bytes.slice(idx || 0);
    var t = bytes[0] &lt;&lt; 8 | bytes[1] &lt;&lt; 0;
    if( (t &amp; 1&lt;&lt;15) &gt; 0){ // temp is negative (16bit 2's complement)
        t = ((~t)&amp; 0xffff)+1; // invert 16bits &amp; add 1 =&gt; now positive value
        t=t*-1;
    }
    return t;
}
function parse_uint16(bytes, idx) {
    bytes = bytes.slice(idx || 0);
    var t = bytes[0] &lt;&lt; 8 | bytes[1] &lt;&lt; 0;
    return t;
}

function toNumber(bytes) {
    var res = 0;
    for (var i = 0, s = 0; i &lt; bytes.length; i++) {
        res |= bytes[i] &lt;&lt; s;
        s += 8;
    }
    return res;
}

function readVersion(bytes) {
    if (bytes.length&lt;3) {
        return null;
    }
    return "v" + bytes[0] + "." + bytes[1] + "." + bytes[2];
}

function decodeStatus(bytes) {
    var decoded = {
        "version":readVersion(bytes),
        "flags": bytes[3],
        "vBat": parse_uint16(bytes, 4) / 1000,
        "temp": parse_int16(bytes, 6) / 10,
    };


    return decoded;
}

function decodeSmlValuesV1(bytes) {
    var decoded = {
        values: [],
    };

    if (bytes.length === 1) {
        // No Data! Read error?
        return decoded;
    }

    var pos = 0;
    while (pos &lt; bytes.length) {
        var name = readName(bytes, pos);
        pos += 6;
        var len = bytes[pos];
        pos += 1;
        var value = readValue(len, bytes, pos);
        pos += len;

        var val = {
            nameHex: toHexString(name),
            len: len,
            value: toNumber(value),
            valueHex: toHexString(value)
        };

        decoded.values.push(val);
    }

    return decoded;
}

function decodeSmlValuesV2(bytes) {
    var decoded = {
        values: [],
    };

    if (bytes.length === 1) {
        // No Data! Read error?
        return decoded;
    }

    var pos = 0;
    while (pos &lt; bytes.length) {
        var name = readName(bytes, pos);
        pos += 6;
        var len = bytes[pos];
        pos += 1;
        var value = readValue(len, bytes, pos);
        pos += len;
        if (len &gt; 0) {
            var exponent = parse_int8(bytes, pos);
            pos += 1;
        }
        if (len &gt; 0) {
            var val = {
                nameHex: toHexString(name),
                len: len,
                value: toNumber(value) * Math.pow(10, exponent),
                valueHex: toHexString(value),
            }
        } else {
            var val = {
                nameHex: toHexString(name),
                len: len,
                value: toNumber(value),
                valueHex: toHexString(value),
            }
        }

        decoded.values.push(val);
    }

    return decoded;
}

function Decoder(bytes, port) {
    // Decode an uplink message from a buffer
    // (array) of bytes to an object of fields.
    if (port === 1) {
        return decodeStatus(bytes);
    }
    if (port === 2) {
        return decodeSmlValuesV1(bytes);
    }
    if (port == 3) {
        return decodeSmlValuesV2(bytes);
    }
}</code></pre>

<h3 id="example-parser-result">Example parser result</h3>
<p>Test input: 01 00 01 08 00 FE 08 7B 7D 23 00 00 00 00 00 FF</p>
<pre class="highlight"><code>{
   "values": [
    {
      "len": 8,
      "nameHex": "0100010800fe",
      "value": 232588.30000000002,
      "valueHex": "7b7d230000000000"
    }
  ]
}</code></pre></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>var base_url = "../.."</script>
    
    <script src="../../js/base.js"></script>
    <script src="../../js/mermaid.min.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>

<!--
MkDocs version : 1.0.4
Build Date UTC : 2019-06-17 18:22:20
-->
